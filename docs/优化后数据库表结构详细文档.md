# ä¼˜åŒ–åæ•°æ®åº“è¡¨ç»“æ„è¯¦ç»†æ–‡æ¡£

**æ•°æ®åº“åç§°ï¼š** æ—¥æœ¬é™†ä¸Šå…»æ®–é¡¹ç›®æ•°æ®åº“ (Japan Aquaculture Database)  
**æ•°æ®åº“ç±»å‹ï¼š** MySQL  
**è®¾è®¡æ–¹æ¡ˆï¼š** ç»Ÿä¸€è®¾å¤‡ç®¡ç†æ¶æ„
**æ–‡æ¡£ç”Ÿæˆæ—¥æœŸï¼š** 2026-01-09  
**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v3.2 (è®¾å¤‡é…ç½®ç»Ÿä¸€ç®¡ç†ç‰ˆ)

---

## ğŸ“‹ ç›®å½•

1. [è¡¨æ¦‚è§ˆ](#è¡¨æ¦‚è§ˆ)
2. [æ ¸å¿ƒä¸šåŠ¡è¡¨](#æ ¸å¿ƒä¸šåŠ¡è¡¨)
3. [è®¾å¤‡ç®¡ç†è¡¨](#è®¾å¤‡ç®¡ç†è¡¨)
4. [ä¼ æ„Ÿå™¨æ¨¡å—](#ä¼ æ„Ÿå™¨æ¨¡å—)
5. [å–‚é£Ÿæœºæ¨¡å—](#å–‚é£Ÿæœºæ¨¡å—)
6. [æ‘„åƒå¤´æ¨¡å—](#æ‘„åƒå¤´æ¨¡å—)
7. [å›¾åƒåˆ†æè¡¨](#å›¾åƒåˆ†æè¡¨)
8. [æ“ä½œæ—¥å¿—è¡¨](#æ“ä½œæ—¥å¿—è¡¨)
9. [AIå†³ç­–è¡¨](#aiå†³ç­–è¡¨)
10. [ç”¨æˆ·ç³»ç»Ÿè¡¨](#ç”¨æˆ·ç³»ç»Ÿè¡¨)
11. [ä»»åŠ¡ç³»ç»Ÿè¡¨](#ä»»åŠ¡ç³»ç»Ÿè¡¨)
12. [çŸ¥è¯†åº“è¡¨](#çŸ¥è¯†åº“è¡¨)
13. [é…ç½®ç®¡ç†è¡¨](#é…ç½®ç®¡ç†è¡¨)
14. [ä¼˜åŒ–å¯¹æ¯”è¯´æ˜](#ä¼˜åŒ–å¯¹æ¯”è¯´æ˜)

---

## è¡¨æ¦‚è§ˆ

æ•°æ®åº“å…±åŒ…å« **38ä¸ªè¡¨**ï¼Œé‡‡ç”¨ç»Ÿä¸€è®¾å¤‡ç®¡ç†æ¶æ„ï¼Œåˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š

| ç±»åˆ« | è¡¨æ•°é‡ | è¯´æ˜ |
|------|--------|------|
| æ ¸å¿ƒä¸šåŠ¡è¡¨ | 2 | å…»æ®–æ± ã€æ‰¹æ¬¡ä¿¡æ¯ |
| è®¾å¤‡ç®¡ç†è¡¨ | 2 | ç»Ÿä¸€è®¾å¤‡ç®¡ç†ã€è®¾å¤‡ç±»å‹ |
| ä¼ æ„Ÿå™¨æ¨¡å— | 10 | ä¼ æ„Ÿå™¨ç±»å‹ã€ä¼ æ„Ÿå™¨æ‰©å±•ã€8å¼ ä¸“ç”¨è¯»æ•°è¡¨ |
| å–‚é£Ÿæœºæ¨¡å— | 2 | å–‚é£Ÿæœºæ‰©å±•ã€å–‚é£Ÿè®°å½• |
| æ‘„åƒå¤´æ¨¡å— | 3 | æ‘„åƒå¤´æ‰©å±•ï¼ˆå«çŠ¶æ€ï¼‰ã€å›¾åƒã€å¥åº·æ£€æŸ¥ |
| å›¾åƒåˆ†æè¡¨ | 1 | è™¾ç±»ç»Ÿè®¡åˆ†æ |
| æ“ä½œæ—¥å¿—è¡¨ | 2 | äººå·¥æ“ä½œæ—¥å¿—ã€å†å²è®°å½• |
| AIå†³ç­–è¡¨ | 3 | AIå†³ç­–ã€æ¶ˆæ¯ç±»å‹ã€å†³ç­–è§„åˆ™ |
| ç”¨æˆ·ç³»ç»Ÿè¡¨ | 3 | ç”¨æˆ·ã€ä¼šè¯ã€èŠå¤©å†å² |
| ä»»åŠ¡ç³»ç»Ÿè¡¨ | 3 | Agentä»»åŠ¡ã€ä»»åŠ¡ç®¡ç†ã€æ¶ˆæ¯é˜Ÿåˆ— |
| çŸ¥è¯†åº“è¡¨ | 3 | çŸ¥è¯†åº“ã€æ–‡æ¡£ã€å…»æ®–æ‰‹å†Œ |
| é…ç½®ç®¡ç†è¡¨ | 4 | å·¥å…·ã€æç¤ºè¯ã€æ¨¡å‹ã€ä¸»é¢˜è®°å¿† |

---

## æ ¸å¿ƒä¸šåŠ¡è¡¨

### 1. pondsï¼ˆå…»æ®–æ± ä¿¡æ¯è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨å…»æ®–æ± çš„åŸºæœ¬ä¿¡æ¯

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | ä¸»é”®ID |
| name | varchar(128) | NO | UNI | NULL | å…»æ®–æ± åç§°ï¼ˆå”¯ä¸€ï¼‰ |
| location | varchar(255) | YES | | NULL | ä½ç½®ä¿¡æ¯ |
| area | float | YES | | NULL | å…»æ®–æ± å®é™…é¢ç§¯ï¼ˆå¹³æ–¹ç±³ï¼‰ |
| shrimp_count | integer | YES | | NULL | å½“å‰è™¾æ•°é‡ï¼ˆå°¾æ•°ï¼‰ |
| description | text | YES | | NULL | æè¿°/å¤‡æ³¨ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY `idx_pond_name` (`name`)

**å…³ç³»ï¼š**
- ä¸€å¯¹å¤šï¼šä¸€ä¸ªå…»æ®–æ± å¯ä»¥æœ‰å¤šä¸ªè®¾å¤‡ (devices)
- ä¸€å¯¹å¤šï¼šä¸€ä¸ªå…»æ®–æ± å¯ä»¥æœ‰å¤šä¸ªæ‰¹æ¬¡ (batches)
- ä¸€å¯¹å¤šï¼šä¸€ä¸ªå…»æ®–æ± å¯ä»¥æœ‰å¤šä¸ªæ“ä½œæ—¥å¿— (operation_logs)

---

### 2. batchesï¼ˆæ‰¹æ¬¡ä¿¡æ¯è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨å…»æ®–æ‰¹æ¬¡çš„åŸºæœ¬ä¿¡æ¯

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| batch_id | bigint | NO | PRI | auto_increment | æ‰¹æ¬¡IDï¼ˆä¸»é”®ï¼‰ |
| pond_id | integer | NO | FK | NULL | æ‰€å±å…»æ®–æ± IDï¼ˆFK â†’ ponds.idï¼‰ |
| species | varchar(64) | NO | | 'Litopenaeus vannamei' | ç‰©ç§ï¼ˆé»˜è®¤å—ç¾ç™½å¯¹è™¾å­¦åï¼‰ |
| start_date | date | NO | | NULL | å¼€å§‹æ—¥æœŸ |
| end_date | date | YES | | NULL | ç»“æŸæ—¥æœŸï¼ˆå¯ç©ºï¼‰ |
| location | varchar(128) | YES | | NULL | åœºåœ°/è½¦é—´ä½ç½® |
| seed_origin | varchar(128) | YES | | NULL | è‹—ç§æ¥æº |
| stocking_density | decimal(10,2) | YES | | NULL | æ”¾å…»å¯†åº¦ï¼ˆå°¾/ã¡æˆ–å°¾/mÂ³ï¼‰ |
| notes | text | YES | | NULL | å¤‡æ³¨ |
| status | varchar(50) | NO | | 'active' | çŠ¶æ€ï¼ˆactive=è¿›è¡Œä¸­/completed=å·²å®Œæˆ/cancelled=å·²å–æ¶ˆï¼‰ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`batch_id`)
- INDEX `idx_batches_pond_dates` (`pond_id`, `start_date`, `end_date`)
- INDEX `idx_batch_status` (`status`)

**å¤–é”®å…³ç³»ï¼š**
- `pond_id` â†’ `ponds.id`

**å…³ç³»ï¼š**
- å¤šå¯¹ä¸€ï¼šå¤šä¸ªæ‰¹æ¬¡å±äºä¸€ä¸ªå…»æ®–æ± 
- ä¸€å¯¹å¤šï¼šä¸€ä¸ªæ‰¹æ¬¡æœ‰å¤šä¸ªä¼ æ„Ÿå™¨è¯»æ•°
- ä¸€å¯¹å¤šï¼šä¸€ä¸ªæ‰¹æ¬¡æœ‰å¤šä¸ªå–‚é£Ÿè®°å½•
- ä¸€å¯¹å¤šï¼šä¸€ä¸ªæ‰¹æ¬¡æœ‰å¤šä¸ªå›¾åƒè®°å½•

---

## è®¾å¤‡ç®¡ç†è¡¨

### 3. device_typesï¼ˆè®¾å¤‡ç±»å‹è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å®šä¹‰è®¾å¤‡ç±»å‹å’Œå¤§ç±»ï¼Œç»Ÿä¸€ç®¡ç†è®¾å¤‡åˆ†ç±»

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | ä¸»é”®ID |
| category | varchar(32) | NO | | NULL | è®¾å¤‡å¤§ç±»ï¼ˆsensor/feeder/camera/actuatorï¼‰ |
| name | varchar(64) | NO | UNI | NULL | è®¾å¤‡ç±»å‹åç§° |
| type_code | varchar(64) | NO | UNI | NULL | è®¾å¤‡ç±»å‹ä»£ç  |
| description | text | YES | | NULL | è®¾å¤‡ç±»å‹æè¿° |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY (`name`)
- UNIQUE KEY (`type_code`)
- INDEX `idx_device_type_category` (`category`)

**è®¾è®¡è¯´æ˜ï¼š**
- åˆå¹¶äº†åŸ device_categories è¡¨ï¼Œé€šè¿‡ category å­—æ®µåŒºåˆ†è®¾å¤‡å¤§ç±»
- ç®€åŒ–äº†è®¾å¤‡ç±»å‹ç®¡ç†ï¼Œé¿å…è¿‡åº¦è®¾è®¡

---

### 4. devicesï¼ˆç»Ÿä¸€è®¾å¤‡ç®¡ç†è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç±»å‹çš„è®¾å¤‡ï¼ˆä¼ æ„Ÿå™¨ã€å–‚é£Ÿæœºã€æ‘„åƒå¤´ç­‰ï¼‰

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | ä¸»é”®ID |
| device_id | varchar(128) | NO | UNI | NULL | è®¾å¤‡å”¯ä¸€æ ‡è¯†ç¬¦ (UUID/SN) |
| name | varchar(128) | NO | | NULL | è®¾å¤‡åç§° |
| description | text | YES | | NULL | è®¾å¤‡æè¿°ä¿¡æ¯ |
| ownership | varchar(128) | NO | | NULL | è®¾å¤‡å½’å± |
| device_type_id | integer | NO | FK | NULL | è®¾å¤‡ç±»å‹IDï¼ˆFK â†’ device_types.idï¼‰ |
| pond_id | integer | YES | FK | NULL | æ‰€å±å…»æ®–æ± IDï¼ˆFK â†’ ponds.idï¼‰ |
| model | varchar(128) | YES | | NULL | è®¾å¤‡å‹å·/è§„æ ¼ |
| manufacturer | varchar(128) | YES | | NULL | åˆ¶é€ å•† |
| serial_number | varchar(128) | YES | UNI | NULL | è®¾å¤‡åºåˆ—å· |
| location | varchar(255) | YES | | NULL | è®¾å¤‡å®‰è£…ä½ç½® |
| firmware_version | varchar(64) | YES | | NULL | å›ºä»¶ç‰ˆæœ¬ |
| hardware_version | varchar(64) | YES | | NULL | ç¡¬ä»¶ç‰ˆæœ¬ |
| ip_address | varchar(45) | YES | | NULL | è®¾å¤‡IPåœ°å€ |
| mac_address | varchar(17) | YES | | NULL | MACåœ°å€ |
| config_json | json | YES | | NULL | è®¾å¤‡é…ç½®å‚æ•°ï¼ˆå¯åŒ…å«è®¤è¯ä¿¡æ¯ã€APIé…ç½®ã€ä¸šåŠ¡é…ç½®ç­‰ï¼‰ |
| tags | json | YES | | NULL | è®¾å¤‡æ ‡ç­¾ï¼ˆJSONæ•°ç»„ï¼‰ |
| installed_at | timestamp | YES | | NULL | å®‰è£…æ—¶é—´ |
| last_maintenance_at | timestamp | YES | | NULL | æœ€åç»´æŠ¤æ—¶é—´ |
| next_maintenance_at | timestamp | YES | | NULL | ä¸‹æ¬¡ç»´æŠ¤æ—¶é—´ |
| warranty_expires_at | timestamp | YES | | NULL | ä¿ä¿®åˆ°æœŸæ—¶é—´ |
| retired_at | timestamp | YES | | NULL | è®¾å¤‡é€€å½¹æ—¶é—´ |
| status | varchar(50) | NO | | 'active' | è®¾å¤‡çŠ¶æ€ï¼ˆactive/inactive/maintenance/retired/errorï¼‰ |
| is_online | boolean | NO | | false | æ˜¯å¦åœ¨çº¿ |
| control_mode | varchar(20) | NO | | 'hybrid' | æ§åˆ¶æƒé™æ¨¡å¼ï¼ˆmanual_only=ä»…äººå·¥/ai_only=ä»…AI/hybrid=äººå·¥+AIååŒï¼‰ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY `idx_device_id` (`device_id`)
- INDEX `idx_device_type_status` (`device_type_id`, `status`)
- INDEX `idx_device_pond_status` (`pond_id`, `status`)
- INDEX `idx_device_control_mode` (`control_mode`)

**å¤–é”®å…³ç³»ï¼š**
- `device_type_id` â†’ `device_types.id`
- `pond_id` â†’ `ponds.id`

**è®¾è®¡ä¼˜åŠ¿ï¼š**
- ç»Ÿä¸€ç®¡ç†æ‰€æœ‰è®¾å¤‡çš„åŸºç¡€ä¿¡æ¯
- é€šè¿‡æ‰©å±•è¡¨ï¼ˆsensors/feeders/camerasï¼‰å­˜å‚¨ç‰¹æœ‰å±æ€§
- æ”¯æŒå®Œæ•´çš„è®¾å¤‡ç”Ÿå‘½å‘¨æœŸç®¡ç†
- `config_json` å­—æ®µçµæ´»å­˜å‚¨è®¾å¤‡é…ç½®ï¼ˆåŒ…æ‹¬è®¤è¯ä¿¡æ¯ã€APIé…ç½®ã€ä¸šåŠ¡å‚æ•°ç­‰ï¼‰

**config_json å­—æ®µä½¿ç”¨ç¤ºä¾‹ï¼š**

**å–‚é£Ÿæœºé…ç½®ï¼ˆåŒ…å«è®¤è¯ä¿¡æ¯ï¼‰ï¼š**
```json
{
  "auth": {
    "type": "username_password",
    "username": "encrypted_xxxxx",
    "password": "encrypted_xxxxx"
  },
  "api": {
    "base_url": "https://ffish.huaeran.cn:8081/commonRequest",
    "timeout": 15,
    "verify_ssl": true
  },
  "business": {
    "feed_portion_weight": 17.0,
    "timezone": 9
  }
}
```

**æ‘„åƒå¤´é…ç½®ï¼ˆAPI Key è®¤è¯ï¼‰ï¼š**
```json
{
  "auth": {
    "type": "api_key",
    "api_key": "encrypted_xxxxx",
    "api_secret": "encrypted_xxxxx"
  },
  "api": {
    "base_url": "https://camera-api.example.com",
    "timeout": 30
  },
  "stream": {
    "resolution": "1920x1080",
    "fps": 30
  }
}
```

**ä¼ æ„Ÿå™¨é…ç½®ï¼ˆMQTTï¼‰ï¼š**
```json
{
  "auth": {
    "type": "mqtt",
    "client_id": "sensor_device_001",
    "username": "encrypted_xxxxx",
    "password": "encrypted_xxxxx"
  },
  "mqtt": {
    "broker": "mqtt.example.com",
    "port": 8883,
    "use_ssl": true
  },
  "sampling": {
    "interval_seconds": 60
  }
}
```

---

## ä¼ æ„Ÿå™¨æ¨¡å—

### 5. sensor_typesï¼ˆä¼ æ„Ÿå™¨ç±»å‹è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å®šä¹‰ä¼ æ„Ÿå™¨æµ‹é‡ç±»å‹

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | ä¸»é”®ID |
| type_name | varchar(128) | NO | UNI | NULL | ç±»å‹åç§°ï¼ˆå¦‚ï¼šæº¶è§£æ°§é¥±å’Œåº¦ï¼‰ |
| metric | varchar(64) | NO | UNI | NULL | metric æ ‡è¯†ç¬¦ï¼ˆdo/ph/temperature/turbidityï¼‰- å¿…å¡«ï¼Œç”¨äºè·¯ç”±æ•°æ®åˆ°å¯¹åº”è¯»æ•°è¡¨ |
| unit | varchar(50) | YES | | NULL | æ•°æ®å•ä½ï¼ˆ%/mm/Â°C/NTUï¼‰ |
| valid_min | float | YES | | NULL | æœ‰æ•ˆå€¼ä¸‹é™ |
| valid_max | float | YES | | NULL | æœ‰æ•ˆå€¼ä¸Šé™ |
| description | text | YES | | NULL | æè¿°/å¤‡æ³¨ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY (`type_name`)
- UNIQUE KEY (`metric`)
- INDEX `idx_sensor_type_metric` (`metric`)

---

### 6. sensorsï¼ˆä¼ æ„Ÿå™¨æ‰©å±•è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨ä¼ æ„Ÿå™¨ç‰¹æœ‰ä¿¡æ¯ï¼ŒåŸºç¡€ä¿¡æ¯é€šè¿‡ device_id å…³è”åˆ° devices è¡¨

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | ä¸»é”®ID |
| device_id | integer | NO | UNI,FK | NULL | å…³è”è®¾å¤‡IDï¼ˆFK â†’ devices.idï¼‰- ä¸€å¯¹ä¸€å…³ç³» |
| sensor_type_id | integer | NO | FK | NULL | ä¼ æ„Ÿå™¨ç±»å‹IDï¼ˆFK â†’ sensor_types.idï¼‰ |
| calibration_date | timestamp | YES | | NULL | æœ€åæ ¡å‡†æ—¥æœŸ |
| calibration_interval_days | integer | YES | | 90 | æ ¡å‡†å‘¨æœŸï¼ˆå¤©ï¼‰ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY `idx_sensor_device` (`device_id`)
- INDEX `idx_sensor_type` (`sensor_type_id`)

**å¤–é”®å…³ç³»ï¼š**
- `device_id` â†’ `devices.id`ï¼ˆä¸€å¯¹ä¸€ï¼‰
- `sensor_type_id` â†’ `sensor_types.id`

**è®¾è®¡è¯´æ˜ï¼š**
- ä¸ devices è¡¨æ˜¯ 1:1 å…³ç³»
- nameã€pond_idã€statusã€model ç­‰åŸºç¡€ä¿¡æ¯ä» devices è¡¨è·å–
- åªå­˜å‚¨ä¼ æ„Ÿå™¨ç‰¹æœ‰çš„æ ¡å‡†ç›¸å…³ä¿¡æ¯

---

### 7-14. ä¼ æ„Ÿå™¨è¯»æ•°è¡¨ï¼ˆ8å¼ ä¸“ç”¨è¡¨ï¼‰

**ä¼˜åŒ–è¯´æ˜ï¼š** åŸ sensor_readings è¡¨æ‹†åˆ†ä¸º 8 å¼ ä¸“ç”¨è¡¨ï¼Œä¾¿äº text2sql æŸ¥è¯¢ä¼˜åŒ–

#### 7. dissolved_oxygen_saturation_readingsï¼ˆæº¶è§£æ°§é¥±å’Œåº¦è¯»æ•°è¡¨ï¼‰

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | bigint | NO | PRI | auto_increment | ä¸»é”®ID |
| sensor_id | integer | NO | FK | NULL | ä¼ æ„Ÿå™¨è®¾å¤‡IDï¼ˆFK â†’ sensors.idï¼‰ |
| pond_id | integer | NO | FK | NULL | æ‰€å±å…»æ®–æ± IDï¼ˆFK â†’ ponds.idï¼‰- å¿«ç…§å­—æ®µï¼Œè®°å½•æ•°æ®äº§ç”Ÿæ—¶çš„æ± ä½ |
| batch_id | bigint | YES | FK | NULL | æ‰¹æ¬¡IDï¼ˆFK â†’ batches.batch_idï¼‰ |
| value | float | NO | | NULL | æº¶è§£æ°§é¥±å’Œåº¦å€¼ |
| metric | varchar(32) | YES | | 'dissolved_oxygen_saturation' | æŒ‡æ ‡æ ‡è¯† |
| unit | varchar(20) | YES | | '%' | å•ä½ |
| description | text | YES | | NULL | æè¿° |
| ts_utc | datetime(3) | NO | | NULL | UTCæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ç²¾åº¦ï¼‰ |
| ts_local | datetime(3) | YES | | NULL | æœ¬åœ°æ—¶é—´æˆ³ï¼ˆæ—¥æœ¬æ—¶åŒºï¼‰ |
| recorded_at | timestamp | YES | | NULL | æ•°æ®è®°å½•æ—¶é—´ï¼ˆå…¼å®¹å­—æ®µï¼‰ |
| quality_flag | varchar(20) | NO | | 'ok' | è´¨é‡æ ‡è®°ï¼ˆok/missing/anomalyï¼‰ |
| checksum | varchar(64) | YES | | NULL | å®Œæ•´æ€§æ ¡éªŒ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- INDEX `idx_do_sat_sensor_ts` (`sensor_id`, `ts_utc`)
- INDEX `idx_do_sat_pond_ts` (`pond_id`, `ts_utc`)
- INDEX `idx_do_sat_batch_ts` (`batch_id`, `ts_utc`)

**å¤–é”®å…³ç³»ï¼š**
- `sensor_id` â†’ `sensors.id`
- `pond_id` â†’ `ponds.id`
- `batch_id` â†’ `batches.batch_id`

**è®¾è®¡è¯´æ˜ï¼š**
- pond_id ä¸º NOT NULL å¿«ç…§å­—æ®µï¼Œè®°å½•æ•°æ®äº§ç”Ÿæ—¶çš„æ± ä½ï¼Œç”¨äºå†å²æ•°æ®ä¸€è‡´æ€§å’ŒLLMæŸ¥è¯¢ä¼˜åŒ–

---

#### 8. ph_readingsï¼ˆpHå€¼è¯»æ•°è¡¨ï¼‰

**å­—æ®µç»“æ„ï¼š** ä¸æº¶è§£æ°§é¥±å’Œåº¦è¯»æ•°è¡¨ç›¸åŒï¼Œvalue å­—æ®µå­˜å‚¨ pH å€¼
**metric é»˜è®¤å€¼ï¼š** 'ph'
**unit é»˜è®¤å€¼ï¼š** NULLï¼ˆpHæ— å•ä½ï¼‰
**pond_idï¼š** NOT NULL å¿«ç…§å­—æ®µï¼Œè®°å½•æ•°æ®äº§ç”Ÿæ—¶çš„æ± ä½

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- INDEX `idx_ph_sensor_ts` (`sensor_id`, `ts_utc`)
- INDEX `idx_ph_pond_ts` (`pond_id`, `ts_utc`)
- INDEX `idx_ph_batch_ts` (`batch_id`, `ts_utc`)

**è®¾è®¡è¯´æ˜ï¼š**
- pond_id ä¸º NOT NULL å¿«ç…§å­—æ®µï¼Œç”¨äºå†å²æ•°æ®ä¸€è‡´æ€§å’ŒLLMæŸ¥è¯¢ä¼˜åŒ–

---

#### 9. temperature_readingsï¼ˆæ¸©åº¦è¯»æ•°è¡¨ï¼‰

**å­—æ®µç»“æ„ï¼š** ä¸æº¶è§£æ°§é¥±å’Œåº¦è¯»æ•°è¡¨ç›¸åŒï¼Œvalue å­—æ®µå­˜å‚¨æ¸©åº¦å€¼
**metric é»˜è®¤å€¼ï¼š** 'temperature'
**unit é»˜è®¤å€¼ï¼š** 'Â°C'
**pond_idï¼š** NOT NULL å¿«ç…§å­—æ®µ

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- INDEX `idx_temp_sensor_ts` (`sensor_id`, `ts_utc`)
- INDEX `idx_temp_pond_ts` (`pond_id`, `ts_utc`)
- INDEX `idx_temp_batch_ts` (`batch_id`, `ts_utc`)

---

#### 10. liquid_level_readingsï¼ˆæ¶²ä½è¯»æ•°è¡¨ï¼‰

**å­—æ®µç»“æ„ï¼š** ä¸æº¶è§£æ°§é¥±å’Œåº¦è¯»æ•°è¡¨ç›¸åŒï¼Œvalue å­—æ®µå­˜å‚¨æ¶²ä½å€¼
**metric é»˜è®¤å€¼ï¼š** 'liquid_level'
**unit é»˜è®¤å€¼ï¼š** 'mm'
**pond_idï¼š** NOT NULL å¿«ç…§å­—æ®µ

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- INDEX `idx_liquid_level_sensor_ts` (`sensor_id`, `ts_utc`)
- INDEX `idx_liquid_level_pond_ts` (`pond_id`, `ts_utc`)
- INDEX `idx_liquid_level_batch_ts` (`batch_id`, `ts_utc`)

---

#### 11. turbidity_readingsï¼ˆæµŠåº¦è¯»æ•°è¡¨ï¼‰

**å­—æ®µç»“æ„ï¼š** ä¸æº¶è§£æ°§é¥±å’Œåº¦è¯»æ•°è¡¨ç›¸åŒï¼Œvalue å­—æ®µå­˜å‚¨æµŠåº¦å€¼
**metric é»˜è®¤å€¼ï¼š** 'turbidity'
**unit é»˜è®¤å€¼ï¼š** 'NTU'
**pond_idï¼š** NOT NULL å¿«ç…§å­—æ®µ

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- INDEX `idx_turbidity_sensor_ts` (`sensor_id`, `ts_utc`)
- INDEX `idx_turbidity_pond_ts` (`pond_id`, `ts_utc`)
- INDEX `idx_turbidity_batch_ts` (`batch_id`, `ts_utc`)

---

#### 12. ammonia_readingsï¼ˆæ°¨æ°®æµ“åº¦è¯»æ•°è¡¨ï¼‰

**å­—æ®µç»“æ„ï¼š** ä¸æº¶è§£æ°§é¥±å’Œåº¦è¯»æ•°è¡¨ç›¸åŒï¼Œvalue å­—æ®µå­˜å‚¨æ°¨æ°®æµ“åº¦å€¼
**metric é»˜è®¤å€¼ï¼š** 'ammonia'
**unit é»˜è®¤å€¼ï¼š** 'mg/L'
**pond_idï¼š** NOT NULL å¿«ç…§å­—æ®µ

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- INDEX `idx_ammonia_sensor_ts` (`sensor_id`, `ts_utc`)
- INDEX `idx_ammonia_pond_ts` (`pond_id`, `ts_utc`)
- INDEX `idx_ammonia_batch_ts` (`batch_id`, `ts_utc`)

---

#### 13. nitrite_readingsï¼ˆäºšç¡é…¸ç›æµ“åº¦è¯»æ•°è¡¨ï¼‰

**å­—æ®µç»“æ„ï¼š** ä¸æº¶è§£æ°§é¥±å’Œåº¦è¯»æ•°è¡¨ç›¸åŒï¼Œvalue å­—æ®µå­˜å‚¨äºšç¡é…¸ç›æµ“åº¦å€¼
**metric é»˜è®¤å€¼ï¼š** 'nitrite'
**unit é»˜è®¤å€¼ï¼š** 'mg/L'
**pond_idï¼š** NOT NULL å¿«ç…§å­—æ®µ

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- INDEX `idx_nitrite_sensor_ts` (`sensor_id`, `ts_utc`)
- INDEX `idx_nitrite_pond_ts` (`pond_id`, `ts_utc`)
- INDEX `idx_nitrite_batch_ts` (`batch_id`, `ts_utc`)

---

#### 14. circulation_readingsï¼ˆå¾ªç¯ç³»ç»Ÿè¯»æ•°è¡¨ï¼‰

**å­—æ®µç»“æ„ï¼š** ä¸æº¶è§£æ°§é¥±å’Œåº¦è¯»æ•°è¡¨ç›¸åŒï¼Œvalue å­—æ®µå­˜å‚¨å¾ªç¯ç³»ç»Ÿè¯»æ•°å€¼
**metric é»˜è®¤å€¼ï¼š** 'circulation'
**unit é»˜è®¤å€¼ï¼š** NULL
**pond_idï¼š** NOT NULL å¿«ç…§å­—æ®µ

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- INDEX `idx_circulation_sensor_ts` (`sensor_id`, `ts_utc`)
- INDEX `idx_circulation_pond_ts` (`pond_id`, `ts_utc`)
- INDEX `idx_circulation_batch_ts` (`batch_id`, `ts_utc`)

---

**ä¼ æ„Ÿå™¨è¯»æ•°è¡¨è®¾è®¡ä¼˜åŠ¿ï¼š**
1. âœ… **text2sql ä¼˜åŒ–**ï¼šæ¯ä¸ªè¡¨åç›´æ¥å¯¹åº”æŒ‡æ ‡ç±»å‹ï¼ŒLLM æ›´å®¹æ˜“ç†è§£
2. âœ… **æŸ¥è¯¢æ€§èƒ½æå‡**ï¼šå•è¡¨æ•°æ®é‡å‡å°ï¼Œç´¢å¼•æ›´é«˜æ•ˆ
3. âœ… **å­—æ®µç»Ÿä¸€**ï¼šæ‰€æœ‰è¡¨ç»“æ„ä¸€è‡´ï¼Œä¾¿äºç»´æŠ¤
4. âœ… **æ‰©å±•æ€§å¼º**ï¼šæ–°å¢ä¼ æ„Ÿå™¨ç±»å‹åªéœ€æ–°å»ºä¸€å¼ è¡¨

---

## å–‚é£Ÿæœºæ¨¡å—

### 15. feedersï¼ˆå–‚é£Ÿæœºæ‰©å±•è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨å–‚é£Ÿæœºç‰¹æœ‰ä¿¡æ¯å’Œäº‘ç«¯åŒæ­¥é…ç½®

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | ä¸»é”®ID |
| device_id | integer | NO | UNI,FK | NULL | å…³è”è®¾å¤‡IDï¼ˆFK â†’ devices.idï¼‰- ä¸€å¯¹ä¸€å…³ç³» |
| **feed_count** | **integer** | **NO** | | **1** | **é»˜è®¤å–‚é£Ÿä»½æ•°ï¼ˆæ¥è‡ªäº‘ç«¯APIçš„feedCountï¼‰** |
| **timezone** | **integer** | **YES** | | **9** | **æ—¶åŒºï¼ˆUTC+ï¼Œå¯¹åº”äº‘ç«¯APIçš„devTimeZoneï¼‰** |
| **network_type** | **integer** | **YES** | | **0** | **ç½‘ç»œç±»å‹ï¼ˆ0=WiFi, 1=4Gï¼Œå¯¹åº”äº‘ç«¯APIçš„netTypeï¼‰** |
| **group_id** | **varchar(50)** | **YES** | **IDX** | **NULL** | **è®¾å¤‡åˆ†ç»„IDï¼ˆå¯¹åº”äº‘ç«¯APIçš„groupIDï¼‰** |
| **feed_portion_weight** | **decimal(5,1)** | **NO** | | **17.0** | **æ¯ä»½é¥²æ–™é‡é‡ï¼ˆå…‹ï¼‰- æœ¬åœ°é…ç½®ï¼Œç”¨äºè®¡ç®—æ€»æŠ•å–‚é‡** |
| capacity_kg | decimal(10,2) | YES | | NULL | é¥²æ–™å®¹é‡ï¼ˆåƒå…‹ï¼‰ |
| feed_type | varchar(64) | YES | | NULL | é¥²æ–™ç±»å‹ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY `idx_feeder_device` (`device_id`)
- INDEX `idx_feeder_group` (`group_id`)

**å¤–é”®å…³ç³»ï¼š**
- `device_id` â†’ `devices.id`ï¼ˆä¸€å¯¹ä¸€ï¼‰

**è®¾è®¡è¯´æ˜ï¼š**
- **äº‘ç«¯åŒæ­¥å­—æ®µ**ï¼šfeed_count, timezone, network_type, group_id ä»äº‘ç«¯ API åŒæ­¥
- **æœ¬åœ°é…ç½®å­—æ®µ**ï¼šfeed_portion_weight ä¸ºæœ¬åœ°é…ç½®ï¼Œç”¨äºè®¡ç®—æŠ•å–‚é‡
- **æŠ•å–‚é‡è®¡ç®—å…¬å¼**ï¼š`total_feed_amount_g = feed_count Ã— feed_portion_weight`
- ç¤ºä¾‹ï¼š1 ä»½ Ã— 17.0 å…‹/ä»½ = 17.0 å…‹

---

### 16. feeder_logsï¼ˆå–‚é£Ÿæœºè¿è¡Œè®°å½•è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨å–‚é£Ÿæœºçš„è¿è¡Œè®°å½•

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | bigint | NO | PRI | auto_increment | ä¸»é”®ID |
| feeder_id | integer | NO | FK | NULL | å–‚é£ŸæœºIDï¼ˆFK â†’ feeders.idï¼‰ |
| pond_id | integer | NO | FK | NULL | æ‰€å±å…»æ®–æ± IDï¼ˆFK â†’ ponds.idï¼‰- å¿«ç…§å­—æ®µï¼Œè®°å½•æŠ•å–‚æ—¶çš„æ± ä½ |
| batch_id | bigint | YES | FK | NULL | æ‰¹æ¬¡IDï¼ˆFK â†’ batches.batch_idï¼‰ |
| ts_utc | datetime(3) | NO | | NULL | UTCæ—¶é—´æˆ³ |
| ts_local | datetime(3) | YES | | NULL | æœ¬åœ°æ—¶é—´æˆ³ |
| feed_amount_g | decimal(12,3) | YES | | NULL | æŠ•å–‚é‡ï¼ˆå…‹ï¼‰ |
| run_time_s | integer | YES | | NULL | è¿è¡Œæ—¶é•¿ï¼ˆç§’ï¼‰ |
| status | varchar(20) | NO | | 'ok' | çŠ¶æ€ï¼ˆok/warning/errorï¼‰ |
| leftover_estimate_g | decimal(12,3) | YES | | NULL | å‰©ä½™é¥µæ–™ä¼°è®¡ï¼ˆå…‹ï¼‰ |
| notes | text | YES | | NULL | å¤‡æ³¨ |
| checksum | varchar(64) | YES | | NULL | å®Œæ•´æ€§æ ¡éªŒ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- INDEX `idx_fl_feeder_ts` (`feeder_id`, `ts_utc`)
- INDEX `idx_fl_pond_ts` (`pond_id`, `ts_utc`)
- INDEX `idx_fl_batch_ts` (`batch_id`, `ts_utc`)
- INDEX `idx_fl_status` (`status`)
- INDEX `idx_fl_pond_status_ts` (`pond_id`, `status`, `ts_utc`)

**å¤–é”®å…³ç³»ï¼š**
- `feeder_id` â†’ `feeders.id`
- `pond_id` â†’ `ponds.id`
- `batch_id` â†’ `batches.batch_id`

**è®¾è®¡è¯´æ˜ï¼š**
- pond_id ä¸º NOT NULL å¿«ç…§å­—æ®µï¼Œè®°å½•æŠ•å–‚æ—¶çš„æ± ä½ï¼Œç”¨äºå†å²æ•°æ®ä¸€è‡´æ€§å’ŒLLMæŸ¥è¯¢ä¼˜åŒ–

---

## æ‘„åƒå¤´æ¨¡å—

### 17. camerasï¼ˆæ‘„åƒå¤´æ‰©å±•è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨æ‘„åƒå¤´é…ç½®å’Œå½“å‰çŠ¶æ€ä¿¡æ¯ã€‚ä¸devicesè¡¨1:1å…³è”ï¼Œä¸sensors/feedersæ¶æ„ä¿æŒä¸€è‡´

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | ä¸»é”®ID |
| device_id | integer | NO | UNI,FK | NULL | å…³è”è®¾å¤‡IDï¼ˆFK â†’ devices.idï¼‰- ä¸€å¯¹ä¸€å…³ç³» |
| status | varchar(50) | NO | IDX | 'offline' | æ‘„åƒå¤´çŠ¶æ€ï¼ˆonline/offlineï¼‰ |
| quality | varchar(50) | YES | | NULL | ç”»è´¨ï¼ˆé«˜/ä¸­/ä½ï¼‰ |
| connectivity | integer | YES | | 0 | è¿é€šæ€§ç™¾åˆ†æ¯” |
| temperature | decimal(5,2) | YES | | NULL | æ¸©åº¦ |
| last_update | bigint | YES | | NULL | æœ€åæ›´æ–°æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |
| last_update_time | varchar(50) | YES | | NULL | æœ€åæ›´æ–°æ—¶é—´å­—ç¬¦ä¸² |
| resolution | varchar(50) | YES | | NULL | åˆ†è¾¨ç‡ |
| fps | integer | YES | | 0 | å¸§ç‡ |
| codec | varchar(32) | YES | | NULL | ç¼–è§£ç  |
| stream_url | varchar(512) | YES | | NULL | æµåª’ä½“åœ°å€ |
| recording | boolean | YES | | false | æ˜¯å¦æ­£åœ¨å½•åˆ¶ |
| night_vision | boolean | YES | | false | æ˜¯å¦å¼€å¯å¤œè§†åŠŸèƒ½ |
| motion_detection | boolean | YES | | false | æ˜¯å¦å¼€å¯è¿åŠ¨æ£€æµ‹ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY `idx_camera_device` (`device_id`)
- INDEX `idx_camera_status` (`status`)

**å¤–é”®å…³ç³»ï¼š**
- `device_id` â†’ `devices.id`ï¼ˆä¸€å¯¹ä¸€ï¼‰

**è®¾è®¡è¯´æ˜ï¼š**
- åˆå¹¶äº†åŸ `cameras` å’Œ `camera_status` è¡¨ï¼Œé¿å…è¿‡åº¦æ‹†åˆ†
- `status`ã€`quality`ã€`connectivity` ç­‰å­—æ®µè¡¨ç¤ºæ‘„åƒå¤´çš„å½“å‰çŠ¶æ€ï¼ˆéæ—¶åºæ•°æ®ï¼‰
- ä¸ `sensors`ã€`feeders` æ¨¡å—ä¿æŒä¸€è‡´çš„æ¶æ„ï¼šæ‰©å±•è¡¨å­˜å‚¨é…ç½®+çŠ¶æ€ï¼Œæ—¶åºæ•°æ®ç‹¬ç«‹æˆè¡¨
- `camera_images` å’Œ `camera_health` ä½œä¸ºæ—¶åºæ•°æ®ç‹¬ç«‹å­˜å‚¨

---

### 18. camera_imagesï¼ˆæ‘„åƒå¤´å›¾ç‰‡è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨æ‘„åƒå¤´æ‹æ‘„çš„å›¾ç‰‡ä¿¡æ¯ï¼ˆæ—¶åºæ•°æ®ï¼‰

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | bigint | NO | PRI | auto_increment | ä¸»é”®ID |
| camera_id | integer | NO | FK | NULL | æ‘„åƒå¤´IDï¼ˆFK â†’ cameras.idï¼‰ |
| pond_id | integer | NO | FK | NULL | æ‰€å±å…»æ®–æ± IDï¼ˆFK â†’ ponds.idï¼‰- å¿«ç…§å­—æ®µï¼Œè®°å½•æ‹æ‘„æ—¶çš„æ± ä½ |
| batch_id | bigint | YES | FK | NULL | æ‰¹æ¬¡IDï¼ˆFK â†’ batches.batch_idï¼‰ |
| image_url | varchar(500) | NO | | NULL | å›¾ç‰‡URL |
| storage_uri | varchar(512) | YES | | NULL | å¯¹è±¡å­˜å‚¨è·¯å¾„/URI |
| last_update | bigint | NO | | NULL | æœ€åæ›´æ–°æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |
| timestamp | bigint | NO | | NULL | å›¾ç‰‡æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |
| ts_utc | datetime(3) | NO | | NULL | UTCæ—¶é—´æˆ³ |
| ts_local | datetime(3) | YES | | NULL | æœ¬åœ°æ—¶é—´æˆ³ï¼ˆæ—¥æœ¬æ—¶åŒºï¼‰ |
| timestamp_str | varchar(50) | YES | | '' | å›¾ç‰‡æ—¶é—´æˆ³å­—ç¬¦ä¸² |
| width | integer | YES | | 1920 | å›¾ç‰‡å®½åº¦ï¼ˆåƒç´ ï¼‰ |
| height | integer | YES | | 1080 | å›¾ç‰‡é«˜åº¦ï¼ˆåƒç´ ï¼‰ |
| format | varchar(20) | YES | | 'jpg' | å›¾ç‰‡æ ¼å¼ï¼ˆjpg/pngç­‰ï¼‰ |
| size | integer | YES | | 0 | å›¾ç‰‡å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |
| fps | integer | YES | | 0 | å¸§ç‡ |
| quality_flag | varchar(20) | NO | | 'ok' | è´¨é‡æ ‡è®°ï¼ˆok/missing/anomalyï¼‰ |
| checksum | varchar(64) | YES | | NULL | å®Œæ•´æ€§æ ¡éªŒ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- INDEX `idx_camera_images_camera` (`camera_id`, `timestamp`)
- INDEX `idx_ci_pond_ts` (`pond_id`, `ts_utc`)
- INDEX `idx_if_batch_ts` (`batch_id`, `ts_utc`)
- INDEX `idx_ci_quality_ts` (`quality_flag`, `ts_utc`)

---

### 19. camera_healthï¼ˆæ‘„åƒå¤´å¥åº·æ£€æŸ¥è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨æ‘„åƒå¤´çš„å¥åº·çŠ¶æ€å’Œæ£€æŸ¥ç»“æœï¼ˆæ—¶åºæ•°æ®ï¼‰

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | ä¸»é”®ID |
| camera_id | integer | NO | FK | NULL | æ‘„åƒå¤´IDï¼ˆFK â†’ cameras.idï¼‰ |
| pond_id | integer | NO | FK | NULL | æ‰€å±å…»æ®–æ± IDï¼ˆFK â†’ ponds.idï¼‰- å¿«ç…§å­—æ®µï¼Œè®°å½•æ£€æŸ¥æ—¶çš„æ± ä½ |
| health_status | varchar(50) | NO | | NULL | å¥åº·çŠ¶æ€ï¼ˆä¼˜ç§€/è‰¯å¥½/ä¸€èˆ¬/éœ€è¦ç»´æŠ¤/ç¦»çº¿ï¼‰ |
| overall_score | decimal(5,2) | NO | | NULL | æ€»ä½“å¥åº·åˆ†æ•°ï¼ˆ0-100ï¼‰ |
| connectivity_status | varchar(50) | NO | | NULL | è¿é€šæ€§æ£€æŸ¥çŠ¶æ€ |
| connectivity_score | integer | NO | | NULL | è¿é€šæ€§åˆ†æ•° |
| connectivity_message | varchar(500) | NO | | NULL | è¿é€šæ€§æ£€æŸ¥æ¶ˆæ¯ |
| image_quality_status | varchar(50) | NO | | NULL | å›¾åƒè´¨é‡æ£€æŸ¥çŠ¶æ€ |
| image_quality_score | integer | NO | | NULL | å›¾åƒè´¨é‡åˆ†æ•° |
| image_quality_message | varchar(500) | NO | | NULL | å›¾åƒè´¨é‡æ£€æŸ¥æ¶ˆæ¯ |
| hardware_status | varchar(50) | NO | | NULL | ç¡¬ä»¶æ£€æŸ¥çŠ¶æ€ |
| hardware_score | integer | NO | | NULL | ç¡¬ä»¶åˆ†æ•° |
| hardware_message | varchar(500) | NO | | NULL | ç¡¬ä»¶æ£€æŸ¥æ¶ˆæ¯ |
| storage_status | varchar(50) | NO | | NULL | å­˜å‚¨æ£€æŸ¥çŠ¶æ€ |
| storage_score | integer | NO | | NULL | å­˜å‚¨åˆ†æ•° |
| storage_message | varchar(500) | NO | | NULL | å­˜å‚¨æ£€æŸ¥æ¶ˆæ¯ |
| timestamp | bigint | NO | | NULL | æ£€æŸ¥æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |
| last_check | varchar(50) | NO | | NULL | æœ€åæ£€æŸ¥æ—¶é—´å­—ç¬¦ä¸² |
| temperature | decimal(5,2) | YES | | NULL | æ¸©åº¦ |
| uptime_hours | integer | YES | | NULL | è¿è¡Œæ—¶é—´ï¼ˆå°æ—¶ï¼‰ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- INDEX `idx_camera_health_camera` (`camera_id`)
- INDEX `idx_ch_pond_ts` (`pond_id`, `timestamp`)
- INDEX `idx_camera_health_status` (`health_status`)

**è®¾è®¡è¯´æ˜ï¼š**
- pond_id ä¸º NOT NULL å¿«ç…§å­—æ®µï¼Œè®°å½•æ£€æŸ¥æ—¶çš„æ± ä½ï¼Œç”¨äºå†å²æ•°æ®ä¸€è‡´æ€§å’ŒLLMæŸ¥è¯¢ä¼˜åŒ–

---

## å›¾åƒåˆ†æè¡¨

### 20. shrimp_statsï¼ˆå›¾åƒè¯†åˆ«ç»Ÿè®¡ç»“æœè¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨å›¾åƒè¯†åˆ«ç»Ÿè®¡ç»“æœ

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | bigint | NO | PRI | auto_increment | ä¸»é”®ID |
| frame_id | bigint | YES | FK | NULL | å›¾åƒå¸§IDï¼ˆFK â†’ camera_images.idï¼‰ |
| batch_id | bigint | YES | FK | NULL | æ‰¹æ¬¡IDï¼ˆFK â†’ batches.batch_idï¼‰ |
| ts_utc | datetime(3) | NO | | NULL | UTCæ—¶é—´æˆ³ï¼ˆæ¨ç†æ—¶é—´ï¼‰ |
| uuid | varchar(36) | YES | | NULL | UUID |
| pond_id | integer | NO | FK | NULL | æ‰€å±å…»æ®–æ± IDï¼ˆFK â†’ ponds.idï¼‰ |
| input_subdir | varchar(255) | YES | | NULL | è¾“å…¥å­ç›®å½• |
| output_dir | varchar(512) | YES | | NULL | è¾“å‡ºç›®å½• |
| created_at_source_iso | varchar(64) | YES | | NULL | æºåˆ›å»ºæ—¶é—´ISO |
| created_at_source | timestamp | YES | | NULL | æºåˆ›å»ºæ—¶é—´ |
| conf | float | YES | | NULL | ç½®ä¿¡åº¦ï¼ˆåŸæœ‰å­—æ®µï¼‰ |
| confidence_avg | decimal(5,4) | YES | | NULL | å¹³å‡ç½®ä¿¡åº¦ |
| iou | float | YES | | NULL | IOU |
| total_live | integer | YES | | NULL | æ´»è™¾æ€»æ•° |
| count | integer | YES | | NULL | æ£€æµ‹æ•°é‡ |
| total_dead | integer | YES | | NULL | æ­»è™¾æ€»æ•° |
| size_min_cm | float | YES | | NULL | æœ€å°å°ºå¯¸ï¼ˆcmï¼‰ |
| size_max_cm | float | YES | | NULL | æœ€å¤§å°ºå¯¸ï¼ˆcmï¼‰ |
| size_mean_cm | float | YES | | NULL | å¹³å‡å°ºå¯¸ï¼ˆcmï¼‰ |
| size_median_cm | float | YES | | NULL | ä¸­ä½æ•°å°ºå¯¸ï¼ˆcmï¼‰ |
| avg_length_mm | decimal(12,3) | YES | | NULL | å¹³å‡é•¿åº¦ï¼ˆæ¯«ç±³ï¼‰ |
| avg_height_mm | decimal(12,3) | YES | | NULL | å¹³å‡é«˜åº¦ï¼ˆæ¯«ç±³ï¼‰ |
| weight_min_g | float | YES | | NULL | æœ€å°ä½“é‡ï¼ˆgï¼‰ |
| weight_max_g | float | YES | | NULL | æœ€å¤§ä½“é‡ï¼ˆgï¼‰ |
| weight_mean_g | float | YES | | NULL | å¹³å‡ä½“é‡ï¼ˆgï¼‰ |
| weight_median_g | float | YES | | NULL | ä¸­ä½æ•°ä½“é‡ï¼ˆgï¼‰ |
| est_weight_g_avg | decimal(12,3) | YES | | NULL | å¹³å‡ä¼°ç®—ä½“é‡ï¼ˆå…‹ï¼‰ |
| feed_present | boolean | YES | | false | æ˜¯å¦å­˜åœ¨é¥²æ–™ |
| shrimp_shell_present | boolean | YES | | false | æ˜¯å¦å­˜åœ¨è™¾çš® |
| model_name | varchar(128) | YES | | NULL | æ¨¡å‹åç§° |
| model_version | varchar(64) | YES | | NULL | æ¨¡å‹ç‰ˆæœ¬ |
| notes | text | YES | | NULL | å¤‡æ³¨ |
| source_file | varchar(512) | YES | | NULL | æºæ–‡ä»¶ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- INDEX `idx_id_frame` (`frame_id`)
- INDEX `idx_id_ts` (`ts_utc`)
- INDEX `idx_shrimp_stats_pond` (`pond_id`)
- INDEX `idx_id_modelver` (`model_name`, `model_version`)
- INDEX `idx_ss_batch_ts` (`batch_id`, `ts_utc`)

**å¤–é”®å…³ç³»ï¼š**
- `frame_id` â†’ `camera_images.id`
- `batch_id` â†’ `batches.batch_id`
- `pond_id` â†’ `ponds.id`

**è®¾è®¡è¯´æ˜ï¼š**
- pond_id ä¸º integer FKï¼Œä¸å…¶ä»–è¡¨ä¿æŒä¸€è‡´
- ts_utc å’Œ pond_id å‡ä¸º NOT NULLï¼Œä¿è¯æ•°æ®å®Œæ•´æ€§

---

## æ“ä½œæ—¥å¿—è¡¨

### 21. operation_logsï¼ˆäººå·¥æ“ä½œæ—¥å¿—è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨äººå·¥æ“ä½œæ—¥å¿—

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | bigint | NO | PRI | auto_increment | ä¸»é”®ID |
| operator_id | integer | NO | FK | NULL | æ“ä½œäººIDï¼ˆFK â†’ users.idï¼‰ |
| batch_id | bigint | YES | FK | NULL | æ‰¹æ¬¡IDï¼ˆFK â†’ batches.batch_idï¼‰ |
| pond_id | integer | YES | FK | NULL | æ‰€å±å…»æ®–æ± IDï¼ˆFK â†’ ponds.idï¼‰ |
| ts_utc | datetime(3) | NO | | NULL | UTCæ—¶é—´æˆ³ |
| ts_local | datetime(3) | YES | | NULL | æœ¬åœ°æ—¶é—´æˆ³ |
| action_type | varchar(64) | NO | | NULL | æ“ä½œç±»å‹ï¼ˆæŠ•æ–™/æ°´è´¨è°ƒæ§/å·¡æ£€/æ¸…æ´—ç­‰ï¼‰ |
| remarks | text | YES | | NULL | å¤‡æ³¨ |
| attachment_uri | varchar(512) | YES | | NULL | é™„ä»¶URI |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- INDEX `idx_ol_operator_ts` (`operator_id`, `ts_utc`)
- INDEX `idx_ol_batch_ts` (`batch_id`, `ts_utc`)
- INDEX `idx_ol_pond_ts` (`pond_id`, `ts_utc`)

**å¤–é”®å…³ç³»ï¼š**
- `operator_id` â†’ `users.id`
- `batch_id` â†’ `batches.batch_id`
- `pond_id` â†’ `ponds.id`

---

### 22. history_recordsï¼ˆå¾€æœŸå…»æ®–è®°å½•è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨å¾€æœŸå…»æ®–è®°å½•ï¼ˆç»“æ„åŒ–ï¼‰

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | bigint | NO | PRI | auto_increment | ä¸»é”®ID |
| batch_id | bigint | YES | FK | NULL | æ‰¹æ¬¡IDï¼ˆFK â†’ batches.batch_idï¼‰ |
| metric_name | varchar(64) | NO | | NULL | æŒ‡æ ‡åç§° |
| value | varchar(128) | NO | | NULL | å€¼ï¼ˆæ–‡æœ¬å­˜å‚¨ï¼‰ |
| unit | varchar(16) | YES | | NULL | å•ä½ |
| ts_utc | datetime(3) | NO | | NULL | UTCæ—¶é—´æˆ³ |
| ts_local | datetime(3) | YES | | NULL | æœ¬åœ°æ—¶é—´æˆ³ |
| notes | text | YES | | NULL | å¤‡æ³¨ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- INDEX `idx_hr_batch_metric_ts` (`batch_id`, `metric_name`, `ts_utc`)

---

## AIå†³ç­–è¡¨

### 23. ai_decisionsï¼ˆAIå†³ç­–æ¶ˆæ¯è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨AIç³»ç»Ÿç”Ÿæˆçš„å„ç±»å†³ç­–æ¶ˆæ¯

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | ä¸»é”®ID |
| decision_id | varchar(64) | NO | UNI | NULL | å†³ç­–å”¯ä¸€æ ‡è¯† |
| type | varchar(50) | NO | | NULL | æ¶ˆæ¯ç±»å‹ï¼ˆanalysis/warning/action/optimizationï¼‰ |
| message | text | NO | | NULL | å†³ç­–æ¶ˆæ¯å†…å®¹ |
| action | text | YES | | NULL | å»ºè®®æ“ä½œå†…å®¹ |
| source | varchar(100) | YES | | NULL | æ•°æ®æºç±»å‹ï¼ˆsensor/device/system/manualï¼‰ |
| source_id | varchar(100) | YES | | NULL | æ•°æ®æºå…·ä½“ID |
| priority | integer | YES | | 0 | ä¼˜å…ˆçº§ï¼ˆ0-10ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼‰ |
| confidence | decimal(5,2) | YES | | 0 | AIå†³ç­–ç½®ä¿¡åº¦ï¼ˆ0-100ï¼‰ |
| status | varchar(50) | NO | | 'active' | çŠ¶æ€ï¼ˆactive/processed/expiredï¼‰ |
| expires_at | timestamp | YES | | NULL | è¿‡æœŸæ—¶é—´ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY (`decision_id`)
- INDEX `idx_decision_type` (`type`)
- INDEX `idx_decision_status` (`status`)
- INDEX `idx_decision_priority` (`priority`)
- INDEX `idx_decision_source` (`source`, `source_id`)

---

### 24. message_typesï¼ˆæ¶ˆæ¯ç±»å‹é…ç½®è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å®šä¹‰ä¸åŒç±»å‹æ¶ˆæ¯çš„æ˜¾ç¤ºæ ·å¼å’Œå±æ€§

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | ä¸»é”®ID |
| type | varchar(50) | NO | UNI | NULL | æ¶ˆæ¯ç±»å‹æ ‡è¯† |
| icon | varchar(10) | NO | | NULL | æ¶ˆæ¯å›¾æ ‡ï¼ˆemojiï¼‰ |
| color | varchar(20) | NO | | NULL | æ¶ˆæ¯é¢œè‰²ï¼ˆhexæˆ–é¢œè‰²åï¼‰ |
| description | varchar(255) | YES | | NULL | æ¶ˆæ¯ç±»å‹æè¿° |
| is_active | boolean | YES | | true | æ˜¯å¦å¯ç”¨è¯¥æ¶ˆæ¯ç±»å‹ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY (`type`)

---

### 25. decision_rulesï¼ˆAIå†³ç­–è§„åˆ™è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å®šä¹‰è§¦å‘AIå†³ç­–çš„æ¡ä»¶å’Œè§„åˆ™

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | ä¸»é”®ID |
| rule_id | varchar(64) | NO | UNI | NULL | è§„åˆ™å”¯ä¸€æ ‡è¯† |
| name | varchar(255) | NO | | NULL | è§„åˆ™åç§° |
| condition_type | varchar(50) | NO | | NULL | æ¡ä»¶ç±»å‹ï¼ˆsensor/device/time/manualï¼‰ |
| condition_config | text | YES | | NULL | æ¡ä»¶é…ç½®ï¼ˆJSONæ ¼å¼ï¼‰ |
| message_template | text | NO | | NULL | æ¶ˆæ¯æ¨¡æ¿ï¼Œæ”¯æŒå˜é‡æ›¿æ¢ |
| action_template | text | YES | | NULL | æ“ä½œæ¨¡æ¿ï¼Œæ”¯æŒå˜é‡æ›¿æ¢ |
| decision_type | varchar(50) | NO | | NULL | å†³ç­–ç±»å‹ï¼ˆanalysis/warning/action/optimizationï¼‰ |
| priority | integer | YES | | 0 | è§„åˆ™ä¼˜å…ˆçº§ï¼ˆ0-10ï¼‰ |
| is_active | boolean | YES | | true | æ˜¯å¦å¯ç”¨è¯¥è§„åˆ™ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY (`rule_id`)
- INDEX `idx_rule_condition_type` (`condition_type`)
- INDEX `idx_rule_decision_type` (`decision_type`)
- INDEX `idx_rule_is_active` (`is_active`)

---

## ç”¨æˆ·ç³»ç»Ÿè¡¨

### 26. usersï¼ˆç”¨æˆ·è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨ç”¨æˆ·ä¿¡æ¯

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | ä¸»é”®ID |
| user_id | varchar(128) | NO | UNI | NULL | ç”¨æˆ·å”¯ä¸€æ ‡è¯†ID |
| username | varchar(128) | NO | UNI | NULL | ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰ |
| password_hash | varchar(128) | NO | | NULL | å¯†ç å“ˆå¸Œå€¼ |
| role | varchar(128) | NO | | NULL | è§’è‰²ï¼ˆadmin=ç®¡ç†å‘˜/employee=å‘˜å·¥/user=æ™®é€šç”¨æˆ·ï¼‰ |
| email | varchar(255) | YES | UNI | NULL | é‚®ç®±ï¼ˆå”¯ä¸€ï¼‰ |
| phone | varchar(32) | YES | UNI | NULL | ç”µè¯ï¼ˆå”¯ä¸€ï¼‰ |
| status | varchar(50) | NO | | 'active' | çŠ¶æ€ï¼ˆactive/inactive/suspendedï¼‰ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY `idx_user_id` (`user_id`)
- UNIQUE KEY `idx_username` (`username`)
- UNIQUE KEY `idx_email` (`email`)
- INDEX `idx_phone` (`phone`)
- INDEX `idx_user_role` (`role`)

**è®¾è®¡è¯´æ˜ï¼š**
- é€šè¿‡ role å­—æ®µåŒºåˆ†ç®¡ç†å‘˜/å‘˜å·¥/æ™®é€šç”¨æˆ·
- å‘˜å·¥è§’è‰²å¯é€šè¿‡ phone/email æ¥æ”¶ä»»åŠ¡é€šçŸ¥

---

### 27. sessionsï¼ˆä¼šè¯è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨ä¼šè¯ä¿¡æ¯

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | ä¸»é”®ID |
| session_id | varchar(128) | NO | UNI | NULL | ä¼šè¯å”¯ä¸€æ ‡è¯†ID |
| user_id | integer | NO | FK | NULL | ç”¨æˆ·IDï¼ˆFK â†’ users.idï¼‰ |
| session_name | varchar(128) | YES | | 'new chat' | ä¼šè¯åç§° |
| config | text | YES | | NULL | ä¼šè¯é…ç½® |
| summary | varchar(2048) | YES | | NULL | ä¼šè¯æ‘˜è¦ |
| status | varchar(50) | NO | | 'active' | çŠ¶æ€ï¼ˆactive/inactiveï¼‰ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY `idx_session_id` (`session_id`)
- INDEX `idx_session_user` (`user_id`)

**å¤–é”®å…³ç³»ï¼š**
- `user_id` â†’ `users.id`

---

### 28. chat_historiesï¼ˆèŠå¤©å†å²è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨èŠå¤©å†å²è®°å½•

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | ä¸»é”®ID |
| session_id | integer | NO | FK | NULL | ä¼šè¯IDï¼ˆFK â†’ sessions.idï¼‰ |
| message_id | varchar(128) | YES | | NULL | æ¶ˆæ¯å”¯ä¸€ID |
| role | varchar(32) | YES | | NULL | è§’è‰²ï¼ˆuser/assistant/systemï¼‰ |
| content | text | YES | | NULL | æ¶ˆæ¯å†…å®¹ |
| type | varchar(50) | YES | | NULL | æ¶ˆæ¯ç±»å‹ |
| tool_calls | text | YES | | NULL | å·¥å…·è°ƒç”¨ï¼ˆJSONï¼‰ |
| meta_data | text | YES | | NULL | å…ƒæ•°æ®ï¼ˆJSONï¼‰ |
| status | varchar(50) | NO | | 'active' | çŠ¶æ€ |
| timestamp | timestamp | NO | | CURRENT_TIMESTAMP | æ—¶é—´æˆ³ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- INDEX `idx_chat_session` (`session_id`)
- INDEX `idx_chat_message` (`message_id`)

**å¤–é”®å…³ç³»ï¼š**
- `session_id` â†’ `sessions.id`

---

## ä»»åŠ¡ç³»ç»Ÿè¡¨

### 29. agent_tasksï¼ˆAgentä»»åŠ¡è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å¤§æ¨¡å‹Agentè¿è¡Œçš„ä»»åŠ¡è¡¨

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | bigint | NO | PRI | auto_increment | ä¸»é”®ID |
| task_id | varchar(255) | NO | UNI | NULL | ä»»åŠ¡å”¯ä¸€æ ‡è¯† |
| session_id | integer | YES | FK | NULL | ä¼šè¯IDï¼ˆFK â†’ sessions.idï¼‰ |
| parent_task_id | varchar(255) | YES | | NULL | çˆ¶ä»»åŠ¡ID |
| goal | text | NO | | NULL | ä»»åŠ¡ç›®æ ‡ |
| input_params | json | YES | | NULL | è¾“å…¥å‚æ•° |
| result | json | YES | | NULL | æ‰§è¡Œç»“æœ |
| error_message | text | YES | | NULL | é”™è¯¯æ¶ˆæ¯ |
| logs | text | YES | | NULL | æ—¥å¿— |
| tool_calls | json | YES | | NULL | å·¥å…·è°ƒç”¨ |
| token_usage | integer | YES | | NULL | Tokenä½¿ç”¨é‡ |
| status | varchar(50) | NO | | 'pending' | çŠ¶æ€ï¼ˆpending/processing/completed/failedï¼‰ |
| priority | integer | YES | | 0 | ä¼˜å…ˆçº§ |
| completed_at | timestamp | YES | | NULL | å®Œæˆæ—¶é—´ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY `idx_agent_task_id` (`task_id`)
- INDEX `idx_agent_task_session` (`session_id`)
- INDEX `idx_agent_task_status` (`status`)

**å¤–é”®å…³ç³»ï¼š**
- `session_id` â†’ `sessions.id`

---

### 30. tasksï¼ˆä»»åŠ¡ç®¡ç†è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** ç”¨äºåˆ†é…ä»»åŠ¡ç»™ç”¨æˆ·ï¼ˆå‘˜å·¥è§’è‰²ï¼‰ï¼Œæ”¯æŒè‡ªåŠ¨é€šçŸ¥

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | ä¸»é”®ID |
| task_id | varchar(64) | NO | UNI | NULL | ä»»åŠ¡å”¯ä¸€æ ‡è¯† |
| task_name | varchar(255) | NO | | NULL | ä»»åŠ¡åç§° |
| description | text | YES | | NULL | ä»»åŠ¡æè¿° |
| priority | varchar(20) | NO | | 'ä¸­' | ä¼˜å…ˆçº§ï¼ˆé«˜/ä¸­/ä½ï¼‰ |
| assignee_id | integer | NO | FK | NULL | è´Ÿè´£äººIDï¼ˆFK â†’ users.idï¼Œè§’è‰²åº”ä¸ºemployeeæˆ–adminï¼‰ |
| pond_id | integer | YES | FK | NULL | å…³è”å…»æ®–æ± IDï¼ˆFK â†’ ponds.idï¼‰ |
| due_date | timestamp | YES | | NULL | æˆªæ­¢æ—¶é—´ |
| task_type | varchar(64) | YES | | NULL | ä»»åŠ¡ç±»å‹ï¼ˆmaintenance/feeding/inspection/cleaning/emergencyï¼‰ |
| status | varchar(50) | NO | | 'pending' | çŠ¶æ€ï¼ˆpending/assigned/in_progress/completed/cancelledï¼‰ |
| started_at | timestamp | YES | | NULL | å¼€å§‹æ—¶é—´ |
| completed_at | timestamp | YES | | NULL | å®Œæˆæ—¶é—´ |
| related_device_id | integer | YES | FK | NULL | å…³è”è®¾å¤‡IDï¼ˆFK â†’ devices.idï¼‰ |
| notes | text | YES | | NULL | å¤‡æ³¨/è¿›åº¦è®°å½• |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY `idx_task_id` (`task_id`)
- INDEX `idx_task_assignee_status` (`assignee_id`, `status`)
- INDEX `idx_task_pond_status` (`pond_id`, `status`)
- INDEX `idx_task_priority_due` (`priority`, `due_date`)
- INDEX `idx_task_status_due` (`status`, `due_date`)

**å¤–é”®å…³ç³»ï¼š**
- `assignee_id` â†’ `users.id`
- `pond_id` â†’ `ponds.id`
- `related_device_id` â†’ `devices.id`

**è®¾è®¡è¯´æ˜ï¼š**
- é€šè¿‡ users è¡¨çš„ phone/email è¿›è¡Œä»»åŠ¡é€šçŸ¥
- assignee_id å¼•ç”¨ users.idï¼Œè¦æ±‚ç”¨æˆ·è§’è‰²ä¸º employee æˆ– admin

---

### 31. message_queuesï¼ˆæ¶ˆæ¯é˜Ÿåˆ—è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨å¾…å¤„ç†çš„æ¶ˆæ¯ï¼Œç”¨äºå¤šæ™ºèƒ½ä½“åä½œç³»ç»Ÿ

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | ä¸»é”®ID |
| message_id | varchar(128) | NO | UNI | NULL | æ¶ˆæ¯å”¯ä¸€æ ‡è¯† |
| content | text | NO | | NULL | æ¶ˆæ¯å†…å®¹ |
| message_metadata | text | YES | | NULL | æ¶ˆæ¯å…ƒæ•°æ®ï¼ˆJSONæ ¼å¼ï¼‰ |
| message_type | varchar(50) | NO | | 'general' | æ¶ˆæ¯ç±»å‹ï¼ˆsensor_data/user_input/system_alert/generalï¼‰ |
| priority | integer | NO | | 5 | æ¶ˆæ¯ä¼˜å…ˆçº§ï¼ˆ0-10ï¼‰ |
| status | varchar(50) | NO | | 'pending' | æ¶ˆæ¯çŠ¶æ€ï¼ˆpending/processing/completed/failed/expiredï¼‰ |
| retry_count | integer | NO | | 0 | é‡è¯•æ¬¡æ•° |
| max_retries | integer | NO | | 3 | æœ€å¤§é‡è¯•æ¬¡æ•° |
| error_message | text | YES | | NULL | å¤„ç†å¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯ |
| consumed_at | timestamp | YES | | NULL | å¼€å§‹å¤„ç†æ—¶é—´ |
| completed_at | timestamp | YES | | NULL | å¤„ç†å®Œæˆæ—¶é—´ |
| expires_at | timestamp | YES | | NULL | æ¶ˆæ¯è¿‡æœŸæ—¶é—´ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | æ¶ˆæ¯æ¥æ”¶æ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY (`message_id`)
- INDEX `idx_mq_status` (`status`)
- INDEX `idx_mq_priority` (`priority`)
- INDEX `idx_mq_message_type` (`message_type`)

---

## çŸ¥è¯†åº“è¡¨

### 32. knowledge_basesï¼ˆçŸ¥è¯†åº“è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨çŸ¥è¯†åº“çš„åŸºæœ¬ä¿¡æ¯

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | è‡ªå¢ä¸»é”®ID |
| knowledge_base_id | varchar(36) | NO | UNI | NULL | çŸ¥è¯†åº“å”¯ä¸€æ ‡è¯†ID |
| knowledge_base_name | varchar(255) | NO | | NULL | çŸ¥è¯†åº“åç§° |
| description | varchar(1024) | YES | | NULL | çŸ¥è¯†åº“æè¿° |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY `idx_kb_id` (`knowledge_base_id`)
- INDEX `idx_kb_name` (`knowledge_base_name`)

---

### 33. knowledge_documentsï¼ˆçŸ¥è¯†åº“æ–‡æ¡£è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨çŸ¥è¯†åº“ä¸­çš„æ–‡æ¡£ä¿¡æ¯

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | è‡ªå¢ä¸»é”®ID |
| knowledge_base_id | integer | NO | FK | NULL | æ‰€å±çŸ¥è¯†åº“IDï¼ˆFK â†’ knowledge_bases.idï¼‰ |
| document_name | varchar(512) | NO | | NULL | æ–‡æ¡£åç§° |
| document_path | varchar(1024) | YES | | NULL | æ–‡æ¡£å­˜å‚¨è·¯å¾„ |
| document_type | varchar(50) | YES | | NULL | æ–‡æ¡£ç±»å‹ï¼ˆtxt/pdf/docxç­‰ï¼‰ |
| file_size | integer | YES | | NULL | æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- INDEX `idx_doc_kb_id` (`knowledge_base_id`)
- INDEX `idx_doc_name` (`document_name`)

**å¤–é”®å…³ç³»ï¼š**
- `knowledge_base_id` â†’ `knowledge_bases.id`

---

### 34. manual_docsï¼ˆå…»æ®–æ‰‹å†Œæ–‡æ¡£ç´¢å¼•è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨å…»æ®–æ‰‹å†Œ/æ–‡æ¡£ç´¢å¼•

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | bigint | NO | PRI | auto_increment | ä¸»é”®ID |
| doc_uri | varchar(512) | NO | | NULL | æ–‡æ¡£URI |
| version | varchar(64) | YES | | NULL | ç‰ˆæœ¬ |
| source | varchar(64) | YES | | NULL | æ¥æº |
| notes | text | YES | | NULL | å¤‡æ³¨ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- INDEX `idx_md_version` (`version`)

---

## é…ç½®ç®¡ç†è¡¨

### 35. toolsï¼ˆå·¥å…·è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨å·¥å…·ä¿¡æ¯

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | ä¸»é”®ID |
| tool_id | varchar(36) | NO | UNI | NULL | å·¥å…·å”¯ä¸€æ ‡è¯†ID |
| name | varchar(255) | NO | UNI | NULL | å·¥å…·åç§° |
| description | varchar(1024) | NO | | NULL | å·¥å…·æè¿° |
| type | varchar(50) | NO | | NULL | å·¥å…·ç±»å‹ |
| mode | varchar(50) | NO | | NULL | å·¥å…·æ¨¡å¼ |
| location | text | YES | | NULL | å·¥å…·çš„ä½ç½®ä¿¡æ¯ |
| schema_def | text | YES | | NULL | å·¥å…·çš„å‚æ•°å®šä¹‰ |
| ownership | varchar(50) | NO | | 'default' | æ‰€æœ‰æƒ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY `idx_tool_id` (`tool_id`)
- UNIQUE KEY `idx_tool_name` (`name`)

---

### 36. promptsï¼ˆæç¤ºè¯æ¨¡æ¿è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** ç”¨äºå­˜å‚¨å’Œç®¡ç†æ‰€æœ‰AIæ™ºèƒ½ä½“çš„æç¤ºï¼ˆPromptï¼‰æ¨¡æ¿

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | ä¸»é”®ID |
| agent_name | varchar(255) | NO | | NULL | æ™ºèƒ½ä½“åç§° |
| template_key | varchar(255) | YES | | NULL | æ¨¡æ¿é”® |
| description | text | YES | | NULL | æ¨¡æ¿æè¿° |
| version | varchar(50) | YES | | NULL | æ¨¡æ¿ç‰ˆæœ¬ |
| template | text | NO | | NULL | æç¤ºæ¨¡æ¿å†…å®¹ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- INDEX `idx_prompt_agent` (`agent_name`)
- UNIQUE KEY `uq_agent_name_template_key` (`agent_name`, `template_key`)

---

### 37. modelsï¼ˆAIæ¨¡å‹è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨å¯ç”¨çš„AIæ¨¡å‹ä¿¡æ¯

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | è‡ªå¢ä¸»é”®ID |
| model_id | varchar(36) | NO | UNI | NULL | æ¨¡å‹å”¯ä¸€æ ‡è¯†ID |
| model_name | varchar(255) | NO | | NULL | æ¨¡å‹åç§°ï¼ˆå¦‚ gpt-4oï¼‰ |
| description | varchar(1024) | NO | | NULL | æ¨¡å‹æè¿° |
| status | varchar(50) | NO | | 'activate' | æ¨¡å‹çŠ¶æ€ï¼ˆactivate/deactivateï¼‰ |
| perm | varchar(50) | NO | | 'public' | æƒé™ç±»å‹ï¼ˆpublic/privateï¼‰ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY `idx_model_id` (`model_id`)
- INDEX `idx_model_status` (`status`)

---

### 38. topic_memoriesï¼ˆè¯é¢˜è®°å¿†è¡¨ï¼‰

**è¡¨è¯´æ˜ï¼š** ç”¨äºå­˜å‚¨æµ·é©¬ä½“å¼çš„åˆ†ç±»è®°å¿†ç”¨æˆ·èŠå¤©è¯é¢˜ä¸»é¢˜

**å­—æ®µè¯¦æƒ…ï¼š**

| å­—æ®µå | ç±»å‹ | å¯ç©º | é”® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|-----|--------|------|
| id | integer | NO | PRI | auto_increment | è‡ªå¢ä¸»é”®ID |
| topic_id | varchar(128) | NO | UNI | NULL | ä¸»é¢˜å”¯ä¸€æ ‡è¯†ID |
| topic_name | varchar(255) | NO | | NULL | å½’ç±»çš„ä¸»é¢˜åç§° |
| topic_content | text | YES | | NULL | æ€»ç»“çš„ä¸»é¢˜å†…å®¹æè¿° |
| related_tags | text | YES | | NULL | è¯¥ä¸»é¢˜çš„å…³é”®æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰ |
| session_id | integer | NO | FK | NULL | åˆ›å»ºè¯¥ä¸»é¢˜çš„ä¼šè¯IDï¼ˆFK â†’ sessions.idï¼‰ |
| status | varchar(50) | NO | | 'active' | ä¸»é¢˜çŠ¶æ€ï¼ˆactive/inactive/deletedï¼‰ |
| created_at | timestamp | NO | | CURRENT_TIMESTAMP | ä¸»é¢˜æœ€åˆåˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | NO | | CURRENT_TIMESTAMP | ä¸»é¢˜æœ€æ–°æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY `idx_topic_id` (`topic_id`)
- INDEX `idx_topic_session` (`session_id`)

**å¤–é”®å…³ç³»ï¼š**
- `session_id` â†’ `sessions.id`

---

## ä¼˜åŒ–å¯¹æ¯”è¯´æ˜

### âœ… ä¸»è¦ä¼˜åŒ–ç‚¹

#### 1. **ç»Ÿä¸€è®¾å¤‡ç®¡ç†æ¶æ„**
- **åŸè®¾è®¡**ï¼šdevicesã€sensorsã€feedersã€cameras å„è‡ªç‹¬ç«‹
- **ä¼˜åŒ–å**ï¼š
  - `devices` ä½œä¸ºç»Ÿä¸€åŸºç¡€è¡¨ï¼Œç®¡ç†æ‰€æœ‰è®¾å¤‡çš„é€šç”¨å±æ€§
  - `sensors`ã€`feeders`ã€`cameras` ä½œä¸ºæ‰©å±•è¡¨ï¼Œåªå­˜å‚¨ç‰¹æœ‰å±æ€§
  - é€šè¿‡ 1:1 å…³ç³» (`device_id` FK) å…³è”
- **ä¼˜åŠ¿**ï¼š
  - âœ… é¿å…æ•°æ®å†—ä½™ï¼ˆnameã€pond_idã€statusã€model ç­‰åªå­˜ä¸€ä»½ï¼‰
  - âœ… ç»Ÿä¸€è®¾å¤‡ç”Ÿå‘½å‘¨æœŸç®¡ç†
  - âœ… ä¾¿äºæ‰©å±•æ–°è®¾å¤‡ç±»å‹

#### 2. **sensor_readings æ‹†åˆ†ä¸º 8 å¼ ä¸“ç”¨è¡¨**
- **åŸè®¾è®¡**ï¼š1 å¼  `sensor_readings` è¡¨å­˜å‚¨æ‰€æœ‰ä¼ æ„Ÿå™¨æ•°æ®
- **ä¼˜åŒ–å**ï¼š8 å¼ ä¸“ç”¨è¡¨
  1. `dissolved_oxygen_saturation_readings` - æº¶è§£æ°§é¥±å’Œåº¦
  2. `ph_readings` - pHå€¼
  3. `temperature_readings` - æ¸©åº¦
  4. `liquid_level_readings` - æ¶²ä½
  5. `turbidity_readings` - æµŠåº¦
  6. `ammonia_readings` - æ°¨æ°®æµ“åº¦
  7. `nitrite_readings` - äºšç¡é…¸ç›æµ“åº¦
  8. `circulation_readings` - å¾ªç¯ç³»ç»Ÿ
- **ä¼˜åŠ¿**ï¼š
  - âœ… **text2sql ä¼˜åŒ–**ï¼šè¡¨åç›´æ¥å¯¹åº”æŒ‡æ ‡ç±»å‹ï¼ŒLLM æ›´å®¹æ˜“ç†è§£
  - âœ… **æŸ¥è¯¢æ€§èƒ½æå‡**ï¼šå•è¡¨æ•°æ®é‡å‡å°ï¼Œç´¢å¼•æ›´é«˜æ•ˆ
  - âœ… **è¯­ä¹‰æ¸…æ™°**ï¼šæ¯å¼ è¡¨å«ä¹‰æ˜ç¡®
  - âœ… **ä¾¿äºæ‰©å±•**ï¼šæ–°å¢æŒ‡æ ‡åªéœ€æ–°å»ºè¡¨

#### 3. **cameras åˆå¹¶ camera_status**
- **åŸè®¾è®¡**ï¼š`cameras`ï¼ˆæ‰©å±•è¡¨ï¼‰å’Œ `camera_status`ï¼ˆçŠ¶æ€è¡¨ï¼‰ä¸¤å¼ ç‹¬ç«‹è¡¨
- **ä¼˜åŒ–å**ï¼š
  - åˆå¹¶ä¸ºå•ä¸ª `cameras` è¡¨
  - åŒ…å«æ‘„åƒå¤´é…ç½®ä¿¡æ¯å’Œå½“å‰çŠ¶æ€ä¿¡æ¯
- **ä¼˜åŠ¿**ï¼š
  - âœ… é¿å…è¿‡åº¦æ‹†åˆ†ï¼š`camera_status` å­˜å‚¨çš„æ˜¯å½“å‰çŠ¶æ€ï¼ˆéæ—¶åºæ•°æ®ï¼‰ï¼Œä¸åº”ç‹¬ç«‹æˆè¡¨
  - âœ… æ¶æ„ä¸€è‡´æ€§ï¼šä¸ `sensors`ã€`feeders` æ¨¡å—ä¿æŒä¸€è‡´
  - âœ… æŸ¥è¯¢ç®€åŒ–ï¼šä¸éœ€è¦é¢å¤– JOIN camera_status è¡¨
  - âœ… å‡å°‘è¡¨æ•°é‡ï¼šä» 39 å¼ å‡å°‘åˆ° 38 å¼ 

#### 4. **device_types åˆå¹¶ device_categories**
- **åŸè®¾è®¡**ï¼šå¯èƒ½å­˜åœ¨ `device_types` å’Œ `device_categories` ä¸¤å¼ è¡¨
- **ä¼˜åŒ–å**ï¼š
  - åªä¿ç•™ `device_types` ä¸€å¼ è¡¨
  - æ·»åŠ  `category` å­—æ®µåŒºåˆ†è®¾å¤‡å¤§ç±»ï¼ˆsensor/feeder/camera/actuatorï¼‰
- **ä¼˜åŠ¿**ï¼š
  - âœ… ç®€åŒ–è¡¨ç»“æ„ï¼Œé¿å…è¿‡åº¦è®¾è®¡
  - âœ… å‡å°‘ JOIN æ“ä½œ
  - âœ… ç®¡ç†æ›´æ–¹ä¾¿

#### 5. **ç»Ÿä¸€ä½¿ç”¨ pond_id FK**
- **åŸè®¾è®¡**ï¼šéƒ¨åˆ†è¡¨ä½¿ç”¨ `pool_id` varchar å­—ç¬¦ä¸²å­—æ®µ
- **ä¼˜åŒ–å**ï¼š
  - æ‰€æœ‰éœ€è¦å…³è”å…»æ®–æ± çš„è¡¨ç»Ÿä¸€ä½¿ç”¨ `pond_id` integer FK â†’ `ponds.id`
  - åˆ é™¤å†—ä½™çš„ `pool_id` å­—æ®µï¼ˆé™¤ shrimp_stats å¤–ï¼‰
- **ä¼˜åŠ¿**ï¼š
  - âœ… æ•°æ®ä¸€è‡´æ€§ï¼šé€šè¿‡ FK çº¦æŸä¿è¯ pond_id æœ‰æ•ˆæ€§
  - âœ… æ— å†—ä½™ï¼šä¸å†ä½¿ç”¨å­—ç¬¦ä¸²å¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´
  - âœ… å…³ç³»æ¸…æ™°ï¼šæ‰€æœ‰è¡¨é€šè¿‡ FK æ˜ç¡®å…³è”åˆ° `ponds` è¡¨
  - âœ… æŸ¥è¯¢ä¼˜åŒ–ï¼šå¯ä»¥é€šè¿‡ JOIN é«˜æ•ˆæŸ¥è¯¢å…»æ®–æ± è¯¦ç»†ä¿¡æ¯

#### 6. **åˆ é™¤æ‰©å±•è¡¨ä¸­çš„å†—ä½™å­—æ®µ**
- **åŸè®¾è®¡**ï¼šsensorsã€feedersã€cameras å¯èƒ½åŒ…å« nameã€pond_idã€modelã€status ç­‰å­—æ®µ
- **ä¼˜åŒ–å**ï¼š
  - æ‰©å±•è¡¨åªä¿ç•™ç‰¹æœ‰å­—æ®µ
  - åŸºç¡€ä¿¡æ¯é€šè¿‡ `device_id` FK ä» `devices` è¡¨è·å–
- **ä¼˜åŠ¿**ï¼š
  - âœ… å•ä¸€æ•°æ®æºï¼ˆSingle Source of Truthï¼‰
  - âœ… é¿å…æ•°æ®ä¸ä¸€è‡´
  - âœ… å‡å°‘å­˜å‚¨ç©ºé—´

#### 7. **å­—æ®µåä¸€è‡´æ€§ä¿®æ­£**
- **åŸè®¾è®¡**ï¼š`devices.device_uuid`
- **ä¼˜åŒ–å**ï¼š`devices.device_id`
- **åŸå› **ï¼šä¸åŸ ORM è®¾è®¡ä¿æŒä¸€è‡´

#### 8. **è¡¥å……é—æ¼å­—æ®µ**
- **shrimp_stats è¡¨**ï¼šè¡¥å…… `pond_id varchar(255)` ä¸šåŠ¡å­—æ®µ

#### 9. **ç»Ÿä¸€å¤–é”®å¼•ç”¨ users.id å’Œ sessions.id**
- **åŸè®¾è®¡**ï¼šéƒ¨åˆ†è¡¨å¼•ç”¨ `users.user_id` (varchar)ï¼Œéƒ¨åˆ†è¡¨å¼•ç”¨ `users.id` (integer)
- **ä¼˜åŒ–å**ï¼š
  - æ‰€æœ‰è¡¨ç»Ÿä¸€å¼•ç”¨ `users.id` (integer PK)
  - æ‰€æœ‰è¡¨ç»Ÿä¸€å¼•ç”¨ `sessions.id` (integer PK)
- **æ¶‰åŠè¡¨**ï¼š`operation_logs`, `sessions`, `chat_histories`, `agent_tasks`, `topic_memories`, `tasks`
- **ä¼˜åŠ¿**ï¼š
  - âœ… æ•°æ®ç±»å‹ä¸€è‡´æ€§ï¼šinteger FK æ€§èƒ½ä¼˜äº varchar FK
  - âœ… å…³ç³»æ¸…æ™°ï¼šç»Ÿä¸€ä½¿ç”¨æ•´æ•°ä¸»é”®ä½œä¸ºå¤–é”®
  - âœ… æŸ¥è¯¢æ€§èƒ½ï¼šæ•´æ•°ç´¢å¼•æ¯”å­—ç¬¦ä¸²ç´¢å¼•æ›´é«˜æ•ˆ

#### 10. **æ‰¹æ¬¡çŠ¶æ€ç®¡ç†**
- **åŸè®¾è®¡**ï¼šé€šè¿‡ `end_date` ä¸º NULL åˆ¤æ–­æ‰¹æ¬¡æ˜¯å¦è¿›è¡Œä¸­
- **ä¼˜åŒ–å**ï¼š
  - æ–°å¢ `batches.status` å­—æ®µï¼ˆactive/completed/cancelledï¼‰
  - æ·»åŠ çŠ¶æ€ç´¢å¼•
- **ä¼˜åŠ¿**ï¼š
  - âœ… è¯­ä¹‰æ¸…æ™°ï¼šçŠ¶æ€å€¼æ˜ç¡®ï¼Œä¸ä¾èµ–æ—¶é—´å­—æ®µæ¨æ–­
  - âœ… æŸ¥è¯¢ä¼˜åŒ–ï¼šç›´æ¥é€šè¿‡ status å­—æ®µè¿‡æ»¤
  - âœ… æ”¯æŒå–æ¶ˆçŠ¶æ€ï¼šåŒºåˆ†"æœªå®Œæˆ"å’Œ"å·²å–æ¶ˆ"

#### 11. **è®¾å¤‡æ§åˆ¶æƒé™ç®¡ç†**
- **ä¼˜åŒ–å**ï¼šdevices è¡¨æ–°å¢ `control_mode` å­—æ®µ
  - `manual_only`ï¼šä»…äººå·¥æ§åˆ¶
  - `ai_only`ï¼šä»…AIæ§åˆ¶
  - `hybrid`ï¼šäººå·¥+AIååŒï¼ˆé»˜è®¤ï¼‰
- **ä¼˜åŠ¿**ï¼š
  - âœ… çµæ´»çš„æƒé™æ§åˆ¶
  - âœ… æ”¯æŒè®¾å¤‡ç®¡ç†åå°çš„æƒé™åˆ†é…åŠŸèƒ½
  - âœ… ä¸ºAIå†³ç­–ç³»ç»Ÿæä¾›æƒé™åˆ¤æ–­ä¾æ®

#### 12. **ä»»åŠ¡ç®¡ç†ä¸­å¿ƒ**
- **åŸè®¾è®¡**ï¼štasks è¡¨ä¸»è¦ç”¨äº LLM å·¥å…·è°ƒç”¨è®°å½•
- **ä¼˜åŒ–å**ï¼šå®Œå…¨é‡æ–°è®¾è®¡ä¸ºä»»åŠ¡ç®¡ç†è¡¨
  - æ–°å¢å­—æ®µï¼š`task_name`, `priority`(é«˜/ä¸­/ä½), `assignee_id`, `pond_id`, `due_date`, `task_type`, `related_device_id`, `notes`
  - åˆ é™¤å­—æ®µï¼š`topic`, `tool_name`, `mode`, `request`, `response`
  - é€šè¿‡ users è¡¨çš„ phone/email è¿›è¡Œä»»åŠ¡é€šçŸ¥
- **ä¼˜åŠ¿**ï¼š
  - âœ… å®Œæ•´çš„ä»»åŠ¡ç®¡ç†åŠŸèƒ½ï¼ˆåˆ†é…ã€è¿½è¸ªã€é€šçŸ¥ï¼‰
  - âœ… æ”¯æŒä¼˜å…ˆçº§å’Œæˆªæ­¢æ—¶é—´
  - âœ… å¯å…³è”å…»æ®–æ± å’Œè®¾å¤‡
  - âœ… é€šè¿‡æ‰‹æœºå’Œé‚®ç®±è‡ªåŠ¨é€šçŸ¥

#### 13. **å†å²æ•°æ®ä¸€è‡´æ€§ï¼ˆå¿«ç…§å­—æ®µï¼‰**
- **åŸè®¾è®¡**ï¼šæ—¶åºè¡¨é€šè¿‡ JOIN è·å– pond_id
- **ä¼˜åŒ–å**ï¼š
  - æ—¶åºè¡¨æ–°å¢ `pond_id` å¿«ç…§å­—æ®µï¼ˆNOT NULLï¼‰
  - è®°å½•æ•°æ®äº§ç”Ÿæ—¶çš„æ± ä½ï¼Œå³ä½¿è®¾å¤‡åæ¥ç§»åŠ¨ä¹Ÿä¸å½±å“å†å²æ•°æ®
- **æ¶‰åŠè¡¨**ï¼šæ‰€æœ‰ä¼ æ„Ÿå™¨è¯»æ•°è¡¨ï¼ˆ8å¼ ï¼‰ã€`feeder_logs`, `camera_images`, `camera_health`
- **ä¼˜åŠ¿**ï¼š
  - âœ… å†å²æ•°æ®å‡†ç¡®æ€§ï¼šåæ˜ æ•°æ®äº§ç”Ÿæ—¶çš„çœŸå®æ± ä½
  - âœ… LLMæŸ¥è¯¢ä¼˜åŒ–ï¼šæ— éœ€ JOIN å³å¯æŒ‰æ± ä½æŸ¥è¯¢
  - âœ… æ€§èƒ½æå‡ï¼šå‡å°‘ JOIN æ“ä½œ

#### 14. **æ•°æ®å®Œæ•´æ€§çº¦æŸå¼ºåŒ–**
- **ä¼˜åŒ–å**ï¼šå…³é”®å­—æ®µæ·»åŠ  NOT NULL çº¦æŸ
  - æ‰€æœ‰ `status` å­—æ®µï¼ˆ11ä¸ªè¡¨ï¼‰
  - æ‰€æœ‰æ—¶åºè¡¨çš„ `ts_utc` å­—æ®µ
  - æ‰€æœ‰æ—¶åºè¡¨çš„ `pond_id` å¿«ç…§å­—æ®µ
  - `sensor_types.metric` è·¯ç”±å­—æ®µ
  - `users.role` å’Œ `users.status`
- **ä¼˜åŠ¿**ï¼š
  - âœ… é˜²æ­¢ç©ºå€¼å¯¼è‡´çš„æŸ¥è¯¢é—®é¢˜
  - âœ… æ•°æ®è´¨é‡ä¿è¯
  - âœ… å‡å°‘åº”ç”¨å±‚åˆ¤ç©ºé€»è¾‘

#### 15. **å–‚é£Ÿæœºé…ç½®å®Œå–„ï¼ˆäº‘ç«¯APIé›†æˆï¼‰**
- **åŸè®¾è®¡**ï¼šfeeders è¡¨åªæœ‰ capacity_kg å’Œ feed_type ä¸¤ä¸ªä¸šåŠ¡å­—æ®µ
- **ä¼˜åŒ–å**ï¼š
  - æ–°å¢äº‘ç«¯åŒæ­¥å­—æ®µï¼š`feed_count`, `timezone`, `network_type`, `group_id`
  - æ–°å¢æœ¬åœ°é…ç½®å­—æ®µï¼š`feed_portion_weight`ï¼ˆæ¯ä»½é¥²æ–™é‡é‡ï¼‰
  - æŠ•å–‚é‡è®¡ç®—å…¬å¼ï¼š`total_feed_amount_g = feed_count Ã— feed_portion_weight`
- **ä¼˜åŠ¿**ï¼š
  - âœ… å®Œæ•´æ”¯æŒäº‘ç«¯ API æ•°æ®åŒæ­¥ï¼ˆdevID, devName, devVersion, feedCount ç­‰ï¼‰
  - âœ… æ”¯æŒè‡ªåŠ¨æŠ•å–‚é‡è®¡ç®—ï¼ˆä»½æ•° Ã— æ¯ä»½é‡é‡ï¼‰
  - âœ… æ”¯æŒè®¾å¤‡åˆ†ç»„ç®¡ç†ï¼ˆgroup_idï¼‰
  - âœ… æ”¯æŒæ—¶åŒºå’Œç½‘ç»œç±»å‹é…ç½®
  - âœ… åŒºåˆ†äº‘ç«¯é…ç½®å’Œæœ¬åœ°é…ç½®

#### 16. **è®¾å¤‡é…ç½®ä¿¡æ¯ç»Ÿä¸€ç®¡ç†**
- **åŸè®¾è®¡**ï¼šé…ç½®ä¿¡æ¯å¯èƒ½åˆ†æ•£åœ¨å¤šä¸ªå­—æ®µæˆ–æ‰©å±•è¡¨ä¸­
- **ä¼˜åŒ–å**ï¼š
  - ä½¿ç”¨ `devices.config_json` å­—æ®µç»Ÿä¸€å­˜å‚¨è®¾å¤‡é…ç½®
  - æ”¯æŒçµæ´»çš„ JSON ç»“æ„ï¼ˆè®¤è¯ä¿¡æ¯ã€APIé…ç½®ã€ä¸šåŠ¡å‚æ•°ç­‰ï¼‰
  - æ”¯æŒå¤šç§è®¤è¯ç±»å‹ï¼šusername_passwordã€api_keyã€oauthã€mqttã€certificate
- **ä¼˜åŠ¿**ï¼š
  - âœ… **æ¶æ„ç®€æ´**ï¼šæ‰€æœ‰é…ç½®ä¿¡æ¯é›†ä¸­åœ¨ä¸€ä¸ªå­—æ®µï¼ŒæŸ¥è¯¢æ— éœ€ JOIN
  - âœ… **çµæ´»æ‰©å±•**ï¼šJSON æ ¼å¼æ”¯æŒä»»æ„é…ç½®ç»“æ„ï¼Œæ— éœ€ä¿®æ”¹è¡¨ç»“æ„
  - âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šå•è¡¨æŸ¥è¯¢ï¼Œé¿å…é¢å¤–çš„å…³è”æŸ¥è¯¢
  - âœ… **å¤šç±»å‹æ”¯æŒ**ï¼šå…¼å®¹å„ç§è®¾å¤‡çš„ä¸åŒé…ç½®éœ€æ±‚
  - âœ… **å®ç”¨æ€§å¼º**ï¼šé€‚åˆä¸­å°å‹é¡¹ç›®ï¼Œé¿å…è¿‡åº¦è®¾è®¡

### ğŸ“Š è¡¨æ•°é‡å¯¹æ¯”

| ç‰ˆæœ¬ | è¡¨æ•°é‡ | è¯´æ˜ |
|------|--------|------|
| åŸè®¾è®¡ | 30 å¼  | åŒ…å« sensor_readingsï¼ˆ1å¼ ï¼‰ã€camera_statusï¼ˆ1å¼ ï¼‰ |
| v3.2 ä¼˜åŒ–å | 38 å¼  | sensor_readings æ‹†åˆ†ä¸º 8 å¼ ï¼ˆ+7ï¼‰ï¼Œcamera_status åˆå¹¶åˆ° camerasï¼ˆ-1ï¼‰ï¼Œå‡€å¢ 8 å¼  |

### ğŸ¯ ä¼˜åŒ–æ•ˆæœ

#### æ€§èƒ½ä¼˜åŒ–
- âœ… ä¼ æ„Ÿå™¨è¯»æ•°æŸ¥è¯¢é€Ÿåº¦æå‡ï¼ˆå•è¡¨æ•°æ®é‡å‡å°ï¼‰
- âœ… ç´¢å¼•æ•ˆç‡æé«˜ï¼ˆæ›´ç²¾å‡†çš„ç´¢å¼•è®¾è®¡ï¼‰
- âœ… JOIN æ“ä½œä¼˜åŒ–ï¼ˆå‡å°‘ä¸å¿…è¦çš„å…³è”ï¼‰

#### æ•°æ®ä¸€è‡´æ€§
- âœ… FK çº¦æŸä¿è¯æ•°æ®å®Œæ•´æ€§
- âœ… ç»Ÿä¸€è®¾å¤‡ç®¡ç†é¿å…å†—ä½™
- âœ… å•ä¸€æ•°æ®æºï¼ˆSSOTï¼‰åŸåˆ™

#### å¯ç»´æŠ¤æ€§
- âœ… è¡¨ç»“æ„æ¸…æ™°ï¼ŒèŒè´£æ˜ç¡®
- âœ… æ‰©å±•æ€§å¼ºï¼ˆæ–°å¢è®¾å¤‡ç±»å‹ã€ä¼ æ„Ÿå™¨ç±»å‹ï¼‰
- âœ… ä¾¿äºç†è§£å’Œç»´æŠ¤

#### AI/LLM å‹å¥½
- âœ… **text2sql ä¼˜åŒ–**ï¼šè¡¨åè¯­ä¹‰åŒ–ï¼ŒLLM æ›´å®¹æ˜“ç”Ÿæˆæ­£ç¡®çš„ SQL
- âœ… **å…³ç³»æ¸…æ™°**ï¼šFK å…³ç³»æ˜ç¡®ï¼Œä¾¿äº LLM ç†è§£æ•°æ®æ¨¡å‹
- âœ… **æ³¨é‡Šå®Œå–„**ï¼šæ¯ä¸ªå­—æ®µéƒ½æœ‰è¯¦ç»†è¯´æ˜

---

## ğŸ“ˆ è¡¨å…³ç³»å›¾

### æ ¸å¿ƒä¸šåŠ¡æ•°æ®æµ

```
ponds (å…»æ®–æ± )
  â”œâ”€â”€ batches (æ‰¹æ¬¡)
  â”‚   â”œâ”€â”€ *_readings (ä¼ æ„Ÿå™¨è¯»æ•° x8)
  â”‚   â”œâ”€â”€ feeder_logs (å–‚é£Ÿè®°å½•)
  â”‚   â”œâ”€â”€ camera_images (å›¾åƒè®°å½•)
  â”‚   â”œâ”€â”€ operation_logs (æ“ä½œæ—¥å¿—)
  â”‚   â””â”€â”€ history_records (å†å²è®°å½•)
  â””â”€â”€ devices (è®¾å¤‡)
      â”œâ”€â”€ sensors (ä¼ æ„Ÿå™¨æ‰©å±•)
      â”œâ”€â”€ feeders (å–‚é£Ÿæœºæ‰©å±•)
      â””â”€â”€ cameras (æ‘„åƒå¤´æ‰©å±•)
```

### è®¾å¤‡ç®¡ç†å…³ç³»

```
device_types (è®¾å¤‡ç±»å‹)
  â””â”€â”€ devices (ç»Ÿä¸€è®¾å¤‡è¡¨)
      â”œâ”€â”€ sensors (ä¼ æ„Ÿå™¨æ‰©å±•) - 1:1
      â”‚   â””â”€â”€ *_readings (8å¼ è¯»æ•°è¡¨) - 1:N
      â”œâ”€â”€ feeders (å–‚é£Ÿæœºæ‰©å±•) - 1:1
      â”‚   â””â”€â”€ feeder_logs (å–‚é£Ÿè®°å½•) - 1:N
      â””â”€â”€ cameras (æ‘„åƒå¤´æ‰©å±•+å½“å‰çŠ¶æ€) - 1:1
          â”œâ”€â”€ camera_images (å›¾åƒ) - 1:N
          â””â”€â”€ camera_health (å¥åº·æ£€æŸ¥) - 1:N
```

### ç”¨æˆ·ä¸ä¼šè¯å…³ç³»

```
users (ç”¨æˆ·)
  â”œâ”€â”€ sessions (ä¼šè¯) - 1:N
  â”‚   â”œâ”€â”€ chat_histories (èŠå¤©å†å²) - 1:N
  â”‚   â”œâ”€â”€ agent_tasks (Agentä»»åŠ¡) - 1:N
  â”‚   â””â”€â”€ topic_memories (è¯é¢˜è®°å¿†) - 1:N
  â””â”€â”€ operation_logs (æ“ä½œæ—¥å¿—) - 1:N
```

---

## ğŸ”§ ç»´æŠ¤å»ºè®®

### å®šæœŸç»´æŠ¤ä»»åŠ¡

1. **æ•°æ®æ¸…ç†**
   - å®šæœŸå½’æ¡£å†å²ä¼ æ„Ÿå™¨è¯»æ•°ï¼ˆä¿ç•™æœ€è¿‘ N å¤©ï¼‰
   - æ¸…ç†è¿‡æœŸçš„ message_queues æ¶ˆæ¯
   - æ¸…ç†è¿‡æœŸçš„ ai_decisions å†³ç­–

2. **ç´¢å¼•ä¼˜åŒ–**
   - å®šæœŸåˆ†æè¡¨ï¼Œæ›´æ–°ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯
   - ç›‘æ§æ…¢æŸ¥è¯¢ï¼Œä¼˜åŒ–ç´¢å¼•
   - æ£€æŸ¥æœªä½¿ç”¨çš„ç´¢å¼•

3. **æ•°æ®å¤‡ä»½**
   - æ¯æ—¥å…¨é‡å¤‡ä»½æ ¸å¿ƒä¸šåŠ¡è¡¨
   - æ¯å°æ—¶å¢é‡å¤‡ä»½ä¼ æ„Ÿå™¨è¯»æ•°è¡¨
   - å®šæœŸæµ‹è¯•æ¢å¤æµç¨‹

4. **æ€§èƒ½ç›‘æ§**
   - ç›‘æ§ 8 å¼ ä¼ æ„Ÿå™¨è¯»æ•°è¡¨çš„å¢é•¿
   - ç›‘æ§ devices è¡¨çš„å˜æ›´
   - ç›‘æ§æŸ¥è¯¢æ€§èƒ½

---

## ğŸ“ é™„å½•

### å¤–é”®å…³ç³»æ±‡æ€»

**æ ¸å¿ƒä¸šåŠ¡è¡¨ï¼š**
- `batches.pond_id` â†’ `ponds.id`

**è®¾å¤‡ç®¡ç†è¡¨ï¼š**
- `devices.device_type_id` â†’ `device_types.id`
- `devices.pond_id` â†’ `ponds.id`

**ä¼ æ„Ÿå™¨æ¨¡å—ï¼š**
- `sensors.device_id` â†’ `devices.id` (1:1)
- `sensors.sensor_type_id` â†’ `sensor_types.id`
- æ‰€æœ‰ `*_readings` è¡¨ï¼ˆ8å¼ ï¼‰ï¼š
  - `sensor_id` â†’ `sensors.id`
  - `pond_id` â†’ `ponds.id` (NOT NULL å¿«ç…§)
  - `batch_id` â†’ `batches.batch_id`

**å–‚é£Ÿæœºæ¨¡å—ï¼š**
- `feeders.device_id` â†’ `devices.id` (1:1)
- `feeder_logs.feeder_id` â†’ `feeders.id`
- `feeder_logs.pond_id` â†’ `ponds.id` (NOT NULL å¿«ç…§)
- `feeder_logs.batch_id` â†’ `batches.batch_id`

**æ‘„åƒå¤´æ¨¡å—ï¼š**
- `cameras.device_id` â†’ `devices.id` (1:1)
- `camera_images.camera_id` â†’ `cameras.id`
- `camera_images.pond_id` â†’ `ponds.id` (NOT NULL å¿«ç…§)
- `camera_images.batch_id` â†’ `batches.batch_id`
- `camera_health.camera_id` â†’ `cameras.id`
- `camera_health.pond_id` â†’ `ponds.id` (NOT NULL å¿«ç…§)

**å›¾åƒåˆ†æï¼š**
- `shrimp_stats.frame_id` â†’ `camera_images.id`
- `shrimp_stats.batch_id` â†’ `batches.batch_id`
- `shrimp_stats.pond_id` â†’ `ponds.id` (NOT NULL)

**æ“ä½œæ—¥å¿—ï¼š**
- `operation_logs.operator_id` â†’ `users.id`
- `operation_logs.batch_id` â†’ `batches.batch_id`
- `operation_logs.pond_id` â†’ `ponds.id`
- `history_records.batch_id` â†’ `batches.batch_id`

**ç”¨æˆ·ç³»ç»Ÿï¼š**
- `sessions.user_id` â†’ `users.id`
- `chat_histories.session_id` â†’ `sessions.id`

**ä»»åŠ¡ç³»ç»Ÿï¼š**
- `agent_tasks.session_id` â†’ `sessions.id`
- `tasks.assignee_id` â†’ `users.id`
- `tasks.pond_id` â†’ `ponds.id`
- `tasks.related_device_id` â†’ `devices.id`

**çŸ¥è¯†åº“ï¼š**
- `knowledge_documents.knowledge_base_id` â†’ `knowledge_bases.id`

**é…ç½®ç®¡ç†ï¼š**
- `topic_memories.session_id` â†’ `sessions.id`

---

**æ–‡æ¡£ç»“æŸ**

---

**ç‰ˆæœ¬å†å²ï¼š**
- v3.2 (2026-01-09) - è®¾å¤‡é…ç½®ä¿¡æ¯ç»Ÿä¸€ç®¡ç†
  - ä½¿ç”¨ devices.config_json å­—æ®µç»Ÿä¸€å­˜å‚¨è®¾å¤‡é…ç½®ï¼ˆè®¤è¯ä¿¡æ¯ã€APIé…ç½®ã€ä¸šåŠ¡å‚æ•°ç­‰ï¼‰
  - æ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼šusername_passwordã€api_keyã€oauthã€mqttã€certificate ç­‰
  - æ¶æ„ç®€æ´å®ç”¨ï¼Œé¿å…è¿‡åº¦è®¾è®¡ï¼Œæ€»è¡¨æ•°ä¿æŒ 38 å¼ 
- v3.1 (2026-01-08) - è¡¥å……å–‚é£Ÿæœºé…ç½®å­—æ®µ
  - feeders è¡¨æ–°å¢äº‘ç«¯åŒæ­¥å­—æ®µï¼šfeed_count, timezone, network_type, group_id
  - feeders è¡¨æ–°å¢æœ¬åœ°é…ç½®å­—æ®µï¼šfeed_portion_weightï¼ˆæ¯ä»½é¥²æ–™é‡é‡ï¼‰
  - æ”¯æŒäº‘ç«¯ API æ•°æ®å®Œæ•´åŒæ­¥å’Œæœ¬åœ°æŠ•å–‚é‡è®¡ç®—
- v3.0 (2026-01-08) - æœ€ç»ˆä¼˜åŒ–ç‰ˆ
  - ç»Ÿä¸€å¤–é”®å¼•ç”¨ users.id/sessions.id (integer)
  - æ·»åŠ æ‰¹æ¬¡çŠ¶æ€ç®¡ç† (batches.status)
  - æ·»åŠ è®¾å¤‡æ§åˆ¶æƒé™ (devices.control_mode)
  - é‡æ–°è®¾è®¡ä»»åŠ¡ç®¡ç†ä¸­å¿ƒ (tasks è¡¨)
  - æ—¶åºè¡¨æ·»åŠ  pond_id å¿«ç…§å­—æ®µ (NOT NULL)
  - å¼ºåŒ–æ•°æ®å®Œæ•´æ€§çº¦æŸ (status, ts_utc, pond_id, metric)
  - åˆå¹¶ employees åˆ° users è¡¨ï¼ˆé€šè¿‡ role å­—æ®µåŒºåˆ†ï¼‰
  - ä¿®æ­£ shrimp_stats.pond_id ä¸º integer FK
  - æ·»åŠ å¤šé¡¹ç´¢å¼•ä¼˜åŒ–
- v2.0 (2026-01-07) - ä¼˜åŒ–ç‰ˆï¼Œé‡‡ç”¨ç»Ÿä¸€è®¾å¤‡ç®¡ç†æ¶æ„ï¼Œæ‹†åˆ†ä¼ æ„Ÿå™¨è¯»æ•°è¡¨
- v1.0 (2025-XX-XX) - åˆå§‹ç‰ˆæœ¬

**è´¡çŒ®è€…ï¼š** AI Assistant (Claude Sonnet 4.5)  
**å®¡æ ¸çŠ¶æ€ï¼š** å·²å®Œæˆå…¨é¢ä¼˜åŒ–

